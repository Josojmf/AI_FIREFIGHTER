server {
    listen 80;
    server_name localhost;
    
    # Frontend en /
    location / {
        proxy_pass http://frontend-dev:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Backoffice en /admin (con reescrituras)
    location /admin {
        proxy_pass http://backoffice-dev:3001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Prefix /admin;
        
        # Reescribe URLs
        proxy_redirect http://localhost:3001/ http://localhost/admin/;
        sub_filter 'href="/' 'href="/admin/';
        sub_filter 'src="/' 'src="/admin/';
        sub_filter_once off;
    }
    
    # API en /api
    location /api {
        proxy_pass http://backend-dev:5000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
