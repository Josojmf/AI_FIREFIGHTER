{% extends "layout.html" %}
{% block title %}Iniciar sesi√≥n | FirefighterAI{% endblock %}

{% block content %}
<section class="auth-fire">
  <div class="auth-bg">
    <div class="bg-gradient"></div>
    <div class="bg-particles"></div>
    <div class="bg-grid"></div>
  </div>

  <div class="auth-grid">
    <!-- Lado informativo -->
    <aside class="auth-aside animate-fade-in" aria-hidden="true">
      <div class="aside-head">
        <div class="flame">üî•</div>
        <h1>Bienvenido de nuevo</h1>
        <p class="muted">Sigue tu plan de estudio, repasa con Leitner y supera tus simulacros.</p>
      </div>
      <ul class="aside-list">
        <li>üìà Progreso en tiempo real</li>
        <li>üß† Repetici√≥n espaciada</li>
        <li>üèÜ Rachas y logros</li>
      </ul>
      <div class="aside-footer">
        <small>FirefighterAI ‚Ä¢ Entrenamiento profesional</small>
      </div>
    </aside>

    <!-- Card login -->
    <div class="auth-card animate-fade-in">
      <header class="auth-header">
        <div class="icon-wrap">üîê</div>
        <div>
          <h2>Iniciar sesi√≥n</h2>
          <p class="muted">Accede a tu cuenta para continuar</p>
        </div>
      </header>

      <form method="POST" id="login-form" novalidate>
        <div class="field">
          <label for="username">Usuario</label>
          <div class="input-wrap">
            <span class="input-icon">üë§</span>
            <input id="username" name="username" placeholder="Ej. m.lopez" autocomplete="username" required>
          </div>
        </div>

        <div class="field">
          <label for="password">Contrase√±a</label>
          <div class="input-wrap">
            <span class="input-icon">üîí</span>
            <input id="password" name="password" type="password" placeholder="Tu contrase√±a"
              autocomplete="current-password" required>
            <button class="ghost-btn" type="button" id="toggle-pass"
              aria-label="Mostrar u ocultar contrase√±a">üëÅÔ∏è</button>
          </div>
          <div class="row-between">
            <label class="check">
              <input type="checkbox" name="remember">
              <span>Recordarme</span>
            </label>
            <a href="/forgot-password" class="link">¬øOlvidaste tu contrase√±a?</a>

          </div>
        </div>

        <button class="btn btn-primary submit-btn" type="submit" id="submit-login">
          <span class="btn-text">Entrar</span>
          <span class="btn-spinner" aria-hidden="true"></span>
        </button>
        <div class="auth-footer">
          <p class="auth-footer-text">
            ¬øNo tienes cuenta?
            <a href="{{ url_for('register') }}" class="auth-link">Reg√≠strate aqu√≠</a>
          </p>
        </div>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="flash-local">
          {% for msg in messages %}
          <p>‚ö†Ô∏è {{ msg }}</p>
          {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
      </form>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<style>
  /* ===== Layout base auth ===== */
  .auth-fire {
    padding: clamp(90px, 12vh, 120px) 1rem 3rem;
    min-height: 100vh;
    position: relative
  }

  .auth-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  /* Asegura que el contenido est√© por encima */
  .auth-grid,
  .auth-card {
    position: relative;
    z-index: 1;
  }

  .auth-bg .bg-gradient,
  .auth-bg .bg-particles,
  .auth-bg .bg-grid {
    position: absolute;
    inset: 0
  }

  .auth-grid {
    margin: 0 auto;
    width: min(1100px, 100%);
    display: grid;
    grid-template-columns: 1.1fr 1fr;
    gap: clamp(1rem, 2.5vw, 2rem);
  }

  .auth-aside {
    background: var(--gradient-card);
    border: 1px solid rgba(220, 38, 38, .25);
    border-radius: var(--radius-2xl);
    padding: clamp(1.2rem, 2.5vw, 2rem);
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .auth-aside::after {
    content: "";
    position: absolute;
    inset: -30%;
    background:
      radial-gradient(600px 300px at 15% 20%, rgba(220, 38, 38, .16), transparent 60%),
      radial-gradient(520px 260px at 90% 80%, rgba(14, 165, 233, .12), transparent 60%);
    filter: blur(8px);
    z-index: -1;
  }

  .aside-head {
    display: grid;
    gap: .6rem;
  }

  .aside-head .flame {
    font-size: 2rem;
    filter: drop-shadow(0 8px 30px rgba(220, 38, 38, .35));
  }

  .auth-aside h1 {
    font-size: clamp(1.5rem, 4vw, 2.2rem);
    font-weight: 800;
  }

  .muted {
    color: var(--text-secondary)
  }

  .aside-list {
    list-style: none;
    display: grid;
    gap: .45rem;
    margin: .8rem 0 1rem;
    font-weight: 600
  }

  .aside-footer {
    color: var(--text-muted);
  }

  /* ===== Card ===== */
  .auth-card {
    background: var(--bg-secondary);
    border: 1px solid rgba(220, 38, 38, .22);
    border-radius: var(--radius-2xl);
    padding: clamp(1.2rem, 2.6vw, 2rem);
    box-shadow: var(--shadow-xl);
  }

  .auth-header {
    display: flex;
    align-items: center;
    gap: .9rem;
    margin-bottom: 1rem
  }

  .icon-wrap {
    width: 44px;
    height: 44px;
    display: grid;
    place-items: center;
    border-radius: 12px;
    background: rgba(220, 38, 38, .15);
    border: 1px solid rgba(220, 38, 38, .35);
    font-size: 1.2rem
  }

  .auth-header h2 {
    font-size: 1.5rem;
    margin: 0
  }

  .auth-header .muted {
    margin-top: .2rem
  }

  /* ===== Form ===== */
  .field {
    margin-bottom: 1rem
  }

  .field label {
    display: block;
    font-weight: 700;
    margin-bottom: .4rem
  }

  .input-wrap {
    position: relative;
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, .05);
    border: 1px solid rgba(255, 255, 255, .12);
    border-radius: var(--radius-lg);
    padding: .25rem .6rem .25rem .9rem;
    transition: border var(--transition-base), box-shadow var(--transition-base);
  }

  .input-wrap:focus-within {
    border-color: rgba(220, 38, 38, .55);
    box-shadow: 0 0 0 4px rgba(220, 38, 38, .12);
  }

  .input-icon {
    opacity: .9;
    margin-right: .4rem
  }

  .input-wrap input {
    width: 100%;
    background: transparent;
    border: 0;
    outline: none;
    color: var(--text-primary);
    padding: .75rem .4rem;
    font-weight: 600;
  }

  .ghost-btn {
    border: 0;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    padding: .35rem;
    border-radius: 10px;
  }

  .ghost-btn:hover {
    background: rgba(255, 255, 255, .06);
    color: #fff
  }

  .row-between {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: .45rem
  }

  .check {
    display: flex;
    align-items: center;
    gap: .45rem;
    color: var(--text-secondary)
  }

  .link {
    color: var(--text-accent);
    border-bottom: 1px dashed rgba(251, 191, 36, .5)
  }

  .link:hover {
    color: #fff;
    border-bottom-color: #fff
  }

  /* ===== Button ===== */
  .submit-btn {
    width: 100%;
    justify-content: center;
    margin-top: .6rem;
    position: relative;
    overflow: hidden
  }

  .btn-spinner {
    width: 1.1rem;
    height: 1.1rem;
    border-radius: 50%;
    border: 3px solid rgba(255, 255, 255, .35);
    border-top-color: #fff;
    margin-left: .6rem;
    display: none;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg)
    }
  }

  .submit-btn.loading .btn-spinner {
    display: inline-block
  }

  .submit-btn.loading .btn-text {
    opacity: .75
  }

  /* ===== Flash ===== */
  .flash-local {
    margin-top: .9rem;
    background: linear-gradient(145deg, rgba(220, 38, 38, .12), var(--bg-secondary));
    border: 1px solid rgba(220, 38, 38, .35);
    padding: .75rem;
    border-radius: 12px;
  }

  /* Responsive */
  @media (max-width: 980px) {
    .auth-grid {
      grid-template-columns: 1fr
    }

    .auth-aside {
      order: 2
    }

    .auth-card {
      order: 1
    }
  }
</style>

<script>
  (() => {
    const pass = document.getElementById('password');
    const toggle = document.getElementById('toggle-pass');
    const form = document.getElementById('login-form');
    const btn = document.getElementById('submit-login');

    toggle?.addEventListener('click', () => {
      const t = pass.type === 'password' ? 'text' : 'password';
      pass.type = t;
      toggle.textContent = t === 'password' ? 'üëÅÔ∏è' : 'üôà';
    });

    form?.addEventListener('submit', () => {
      btn.classList.add('loading');
      btn.setAttribute('disabled', 'disabled');
    });
  })();
</script>
{% endblock %}