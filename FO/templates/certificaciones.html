{% extends "layout.html" %}

{% block title %}Certificaciones - FirefighterAI{% endblock %}

{% block styles %}
<style>
  /* Estilos espec√≠ficos para certificaciones */
  .certificaciones-hero {
    padding: 2.5rem 0 1rem;
    text-align: center;
  }

  .hero-badge {
    display: inline-flex;
    gap: .5rem;
    align-items: center;
    padding: .35rem .7rem;
    border-radius: 999px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    color: var(--text-secondary);
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .hero-title {
    font-size: clamp(1.8rem, 5vw, 2.6rem);
    font-weight: 800;
    margin: .6rem 0 .3rem;
    line-height: 1.2;
  }

  .hero-subtitle {
    color: var(--text-secondary);
    max-width: 820px;
    margin: 0 auto 1.5rem;
    font-size: 1.1rem;
  }

  .hero-features {
    display: flex;
    gap: .8rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .feature-item {
    display: flex;
    gap: .4rem;
    align-items: center;
    padding: .45rem .7rem;
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 999px;
    background: rgba(255,255,255,.04);
    color: var(--text-secondary);
    font-weight: 600;
  }

  .platform-controls {
    padding: 1rem 0;
  }

  .controls-wrapper {
    background: var(--gradient-card);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius-xl);
    padding: 1.5rem;
    text-align: center;
  }

  .controls-header {
    margin-bottom: 1rem;
  }

  .controls-header h2 {
    margin-bottom: .5rem;
  }

  .controls-grid {
    display: flex;
    gap: .6rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .control-btn {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    padding: .8rem 1.1rem;
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    cursor: pointer;
    font-weight: 600;
    transition: all var(--transition-base);
    text-decoration: none;
    color: inherit;
  }

  .control-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,.2);
  }

  .iframe-container {
    position: relative;
    border-radius: var(--radius-xl);
    background: var(--gradient-card);
    border: 1px solid rgba(255,255,255,.08);
    box-shadow: 0 14px 40px rgba(0,0,0,.35);
    overflow: hidden;
    min-height: 400px;
  }

  .iframe-loading {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, rgba(11,11,15,.75), rgba(11,11,15,.35));
    backdrop-filter: blur(4px);
    z-index: 10;
    text-align: center;
    padding: 2rem;
  }

  .iframe-error {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, rgba(11,11,15,.9), rgba(11,11,15,.6));
    backdrop-filter: blur(6px);
    z-index: 10;
    text-align: center;
    padding: 2rem;
  }

  .loading-spinner-large {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 4px solid rgba(255,255,255,.2);
    border-top-color: #fff;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .error-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .error-actions {
    display: flex;
    gap: .8rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 1.5rem;
  }

  .platform-info {
    margin: 2rem 0;
  }

  .info-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .info-card {
    background: var(--gradient-card);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    text-align: center;
  }

  .card-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: block;
  }

  .faq-section {
    margin: 2rem 0;
  }

  .faq-container {
    display: flex;
    flex-direction: column;
    gap: .8rem;
  }

  .faq-item {
    background: var(--gradient-card);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .faq-question {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    padding: 1rem;
    list-style: none;
  }

  .faq-question::-webkit-details-marker {
    display: none;
  }

  .faq-answer {
    padding: 0 1rem 1rem;
    color: var(--text-secondary);
  }

  .cta-section {
    padding: 2rem 0;
    text-align: center;
  }

  .cta-content {
    background: var(--gradient-card);
    border-radius: var(--radius-xl);
    padding: 2rem;
    border: 1px solid rgba(255,255,255,.08);
  }

  .cta-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  /* Animaciones */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity .6s ease, transform .6s ease;
  }

  .animate-in {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .controls-grid {
      flex-direction: column;
      align-items: center;
    }
    
    .control-btn {
      width: 100%;
      justify-content: center;
    }
    
    .error-actions, .cta-buttons {
      flex-direction: column;
    }
    
    .info-cards {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Certificaciones Hero Section -->
<section class="certificaciones-hero">
  <div class="container">
    <div class="hero-content animate-on-scroll">
      <div class="hero-badge">
        <span class="badge-icon">üéì</span>
        <span class="badge-text">Plataforma de Certificaciones Profesionales</span>
      </div>
      <h1 class="hero-title">
        <span class="text-gradient">Certificaciones</span><br>
        Oficiales y Formaci√≥n <span class="text-gradient">Reconocida</span>
      </h1>
      <p class="hero-subtitle">
        Accede a contenidos acreditados, programas con reconocimiento oficial
        y v√≠as de certificaci√≥n profesional para tu desarrollo como bombero.
      </p>
      <div class="hero-features">
        <div class="feature-item"><span class="feature-icon">üèÜ</span><span class="feature-text">Reconocimiento Oficial</span></div>
        <div class="feature-item"><span class="feature-icon">üìã</span><span class="feature-text">Programas Acreditados</span></div>
        <div class="feature-item"><span class="feature-icon">üéØ</span><span class="feature-text">Desarrollo Profesional</span></div>
      </div>
    </div>
  </div>
</section>

<!-- Platform Controls -->
<section class="platform-controls">
  <div class="container">
    <div class="controls-wrapper animate-on-scroll">
      <div class="controls-header">
        <h2>Plataforma de Formaci√≥n Certificada</h2>
        <p>Gestiona tu experiencia de aprendizaje con los controles avanzados</p>
      </div>
      <div class="controls-grid">
        <a href="https://www.onfireacademy.es/" target="_blank" rel="noopener" class="control-btn btn-primary" id="openExternal">
          <span class="btn-icon">üåê</span><span class="btn-text">Abrir en Nueva Pesta√±a</span>
        </a>
        <button type="button" class="control-btn btn-secondary" id="reloadFrame">
          <span class="btn-icon">üîÑ</span><span class="btn-text">Recargar Plataforma</span>
        </button>
        <button type="button" class="control-btn btn-secondary" id="toggleFit">
          <span class="btn-icon">‚ÜïÔ∏è</span><span class="btn-text">Ajustar Altura</span>
        </button>
        <button type="button" class="control-btn btn-accent" id="enterFullscreen">
          <span class="btn-icon">‚õ∂</span><span class="btn-text">Pantalla Completa</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Embedded Platform -->
<section class="embedded-platform-section">
  <div class="container">
    <div class="iframe-container animate-on-scroll" id="embedCard">
      <!-- Loader - Mostrado inicialmente -->
      <div id="loader" class="iframe-loading">
        <div class="loading-content">
          <div class="loading-spinner-large"></div>
          <h3>Cargando Plataforma de Certificaciones</h3>
          <p>Conectando con la plataforma oficial...</p>
        </div>
      </div>

      <!-- Bloqueado - Mostrado si falla la carga -->
      <div id="frameBlocked" class="iframe-error" style="display:none;">
        <div class="error-content">
          <div class="error-icon">üõ°Ô∏è</div>
          <h3>Contenido Bloqueado por Seguridad</h3>
          <p>La plataforma utiliza pol√≠ticas que impiden su visualizaci√≥n embebida.</p>
          <div class="error-details">
            <h4>Detalles t√©cnicos:</h4>
            <ul class="error-reasons">
              <li><code>X-Frame-Options</code></li>
              <li><code>Content-Security-Policy: frame-ancestors</code></li>
              <li>Protecci√≥n contra clickjacking</li>
            </ul>
          </div>
          <div class="error-actions">
            <a href="https://www.onfireacademy.es/" target="_blank" rel="noopener" class="btn btn-primary">
              <span class="btn-icon">üîó</span><span class="btn-text">Abrir en Nueva Ventana</span>
            </a>
            <button type="button" class="btn btn-secondary" id="tryAgain">
              <span class="btn-icon">üîÑ</span><span class="btn-text">Reintentar Carga</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Iframe - Oculto inicialmente -->
      <div class="iframe-wrapper" id="embedAspect" style="display:none;">
        <iframe id="certFrame" 
                src="{{ proxied_url if proxied_url else '/onfire-academy/' }}" 
                frameborder="0"
                allowfullscreen 
                referrerpolicy="no-referrer-when-downgrade"
                sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
                title="Plataforma de Certificaciones Profesionales" 
                loading="lazy">
        </iframe>
      </div>
    </div>

    <!-- Info Cards -->
    <div class="platform-info animate-on-scroll">
      <div class="info-cards">
        <div class="info-card">
          <div class="card-icon">üìú</div>
          <h3>Certificaciones Oficiales</h3>
          <p>Certificados reconocidos por organismos oficiales del sector.</p>
        </div>
        <div class="info-card">
          <div class="card-icon">üë®‚Äçüè´</div>
          <h3>Instructores Expertos</h3>
          <p>Aprende con profesionales con a√±os de experiencia.</p>
        </div>
        <div class="info-card">
          <div class="card-icon">üéØ</div>
          <h3>Formaci√≥n Especializada</h3>
          <p>Programas adaptados a necesidades del sector.</p>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="faq-section animate-on-scroll">
      <h2 class="section-title">Preguntas Frecuentes</h2>
      <div class="faq-container">
        <details class="faq-item">
          <summary class="faq-question"><span>¬øPor qu√© a veces no se muestra el contenido embebido?</span><span class="faq-icon">‚ñº</span></summary>
          <div class="faq-answer">
            <p>Algunos sitios bloquean iframes por seguridad (XFO/CSP). Usa "Abrir en Nueva Pesta√±a".</p>
          </div>
        </details>
        <details class="faq-item">
          <summary class="faq-question"><span>¬øC√≥mo maximizo mi experiencia?</span><span class="faq-icon">‚ñº</span></summary>
          <div class="faq-answer">
            <ul>
              <li>Usa pantalla completa</li>
              <li>Ajusta la altura</li>
              <li>Conexi√≥n estable</li>
              <li>Navegador actualizado</li>
            </ul>
          </div>
        </details>
        <details class="faq-item">
          <summary class="faq-question"><span>¬øLas certificaciones tienen validez oficial?</span><span class="faq-icon">‚ñº</span></summary>
          <div class="faq-answer">
            <p>S√≠: reconocimiento institucional, certificados verificables y v√°lidos en procesos.</p>
          </div>
        </details>
      </div>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="cta-section">
  <div class="container">
    <div class="cta-content animate-on-scroll">
      <div class="cta-icon">üéì</div>
      <h2 class="cta-title">¬øListo para obtener tu certificaci√≥n profesional?</h2>
      <p class="cta-subtitle">Accede a la formaci√≥n m√°s completa y reconocida del sector.</p>
      <div class="cta-buttons">
        <a href="https://www.onfireacademy.es/" target="_blank" rel="noopener" class="btn btn-primary btn-large">
          <span class="btn-icon">üöÄ</span><span class="btn-text">Comenzar Certificaci√≥n</span>
        </a>
        <a href="/contact" class="btn btn-secondary btn-large">
          <span class="btn-icon">üí¨</span><span class="btn-text">M√°s Informaci√≥n</span>
        </a>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Inicialmente mostrar el loader y ocultar el iframe
  const loader = document.getElementById('loader');
  const blocked = document.getElementById('frameBlocked');
  const iframeWrapper = document.getElementById('embedAspect');
  const frame = document.getElementById('certFrame');

  // Mostrar loader inmediatamente
  loader.style.display = 'flex';
  iframeWrapper.style.display = 'none';
  blocked.style.display = 'none';

  // Configurar eventos para detectar si el iframe est√° bloqueado
  let isBlocked = false;

  // Verificar si el iframe est√° bloqueado despu√©s de un tiempo
  const checkIfBlocked = setTimeout(() => {
    try {
      const iframeDoc = frame.contentDocument || frame.contentWindow.document;
      if (iframeDoc && iframeDoc.body) {
        loader.style.display = 'none';
        iframeWrapper.style.display = 'block';
      }
    } catch (e) {
      isBlocked = true;
      loader.style.display = 'none';
      blocked.style.display = 'flex';
      iframeWrapper.style.display = 'none';
    }
  }, 3000);

  // Evento de carga del iframe
  frame.addEventListener('load', () => {
    clearTimeout(checkIfBlocked);
    setTimeout(() => {
      try {
        const iframeDoc = frame.contentDocument || frame.contentWindow.document;
        if (iframeDoc && iframeDoc.body && iframeDoc.body.children.length > 0) {
          loader.style.display = 'none';
          iframeWrapper.style.display = 'block';
        } else {
          isBlocked = true;
          loader.style.display = 'none';
          blocked.style.display = 'flex';
          iframeWrapper.style.display = 'none';
        }
      } catch (e) {
        isBlocked = true;
        loader.style.display = 'none';
        blocked.style.display = 'flex';
        iframeWrapper.style.display = 'none';
      }
    }, 500);
  });

  // Evento de error del iframe
  frame.addEventListener('error', () => {
    clearTimeout(checkIfBlocked);
    isBlocked = true;
    loader.style.display = 'none';
    blocked.style.display = 'flex';
    iframeWrapper.style.display = 'none';
  });

  // Botones de control
  const tryAgain = document.getElementById('tryAgain');
  const reloadBtn = document.getElementById('reloadFrame');
  const fsBtn = document.getElementById('enterFullscreen');
  const card = document.getElementById('embedCard');

  if (tryAgain) {
    tryAgain.addEventListener('click', () => {
      loader.style.display = 'flex';
      blocked.style.display = 'none';
      iframeWrapper.style.display = 'none';
      frame.src = frame.src.split('?')[0] + '?t=' + new Date().getTime();
    });
  }

  if (reloadBtn) {
    reloadBtn.addEventListener('click', () => {
      loader.style.display = 'flex';
      blocked.style.display = 'none';
      iframeWrapper.style.display = 'none';
      try {
        frame.contentWindow.location.reload();
      } catch {
        frame.src = frame.src.split('?')[0] + '?t=' + new Date().getTime();
      }
    });
  }

  if (fsBtn) {
    fsBtn.addEventListener('click', async () => {
      try {
        if (document.fullscreenElement) {
          await document.exitFullscreen();
        } else {
          await card.requestFullscreen();
        }
      } catch (e) {
        console.warn('Fullscreen no disponible:', e);
      }
    });
  }

  // Animaciones de scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });

  document.querySelectorAll('.animate-on-scroll').forEach(el => {
    observer.observe(el);
  });
});
</script>
{% endblock %}