{% extends "layout.html" %}

{% block title %}Crear Cuenta - FirefighterAI{% endblock %}

{% block content %}
<!-- Background Effects -->
<div class="auth-background">
  <div class="bg-gradient-overlay"></div>
  <div class="floating-particles">
    {% for i in range(20) %}
    <div class="particle" style="
      left: {{ range(0, 100) | random }}%;
      animation-delay: {{ range(0, 500) | random / 100 }}s;
      animation-duration: {{ range(500, 900) | random / 100 }}s;
    "></div>
    {% endfor %}
  </div>
</div>

<!-- Auth Container -->
<section class="auth-section">
  <div class="container">
    <div class="auth-layout">
      
      <!-- Left Side - Form -->
      <div class="auth-form-container">
        <!-- Header -->
        <div class="auth-header">
          <div class="auth-brand">
            <div class="brand-icon">üöÄ</div>
            <div class="brand-text">FirefighterAI</div>
          </div>
          <h1 class="auth-title">√önete al equipo</h1>
          <p class="auth-subtitle">Comienza tu preparaci√≥n profesional hoy mismo</p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-step active" data-step="1">
            <div class="step-circle">1</div>
            <span class="step-label">Datos b√°sicos</span>
          </div>
          <div class="progress-line">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-step" data-step="2">
            <div class="step-circle">2</div>
            <span class="step-label">Verificaci√≥n</span>
          </div>
        </div>

        <!-- Form -->
        <form method="POST" class="auth-form" id="registerForm" novalidate>
          <!-- Step 1: Basic Information -->
          <div class="form-step active" id="step1">
            <div class="form-group">
              <label for="username" class="form-label">
                <span class="label-icon">üë§</span>
                <span class="label-text">Usuario</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="username"
                  name="username" 
                  class="form-input" 
                  placeholder="Elige tu nombre de usuario"
                  required
                  autocomplete="username"
                  minlength="3"
                  maxlength="24"
                  pattern="[a-zA-Z0-9]+"
                  title="Solo letras y n√∫meros, entre 3-24 caracteres"
                >
                <div class="input-validation" id="usernameValidation"></div>
                <div class="input-focus-border"></div>
              </div>
              <div class="input-hint">M√≠nimo 3 caracteres, solo letras y n√∫meros</div>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">
                <span class="label-icon">üìß</span>
                <span class="label-text">Email</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="email" 
                  id="email"
                  name="email" 
                  class="form-input" 
                  placeholder="tu.email@ejemplo.com"
                  required
                  autocomplete="email"
                >
                <div class="input-validation" id="emailValidation"></div>
                <div class="input-focus-border"></div>
              </div>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">
                <span class="label-icon">üîë</span>
                <span class="label-text">Contrase√±a</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="password" 
                  id="password"
                  name="password" 
                  class="form-input" 
                  placeholder="Crea una contrase√±a segura"
                  required
                  autocomplete="new-password"
                  minlength="8"
                >
                <button type="button" class="password-toggle" id="togglePassword" aria-label="Mostrar u ocultar contrase√±a">
                  <span class="toggle-icon">üëÅÔ∏è</span>
                </button>
                <div class="input-focus-border"></div>
              </div>
              
              <!-- Password Strength Indicator -->
              <div class="password-strength" id="passwordStrength">
                <div class="strength-bar">
                  <div class="strength-fill" id="strengthFill"></div>
                </div>
                <div class="strength-text">Fortaleza de la contrase√±a</div>
                <div class="strength-requirements">
                  <div class="requirement" data-req="length">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">M√≠nimo 8 caracteres</span>
                  </div>
                  <div class="requirement" data-req="uppercase">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 may√∫scula</span>
                  </div>
                  <div class="requirement" data-req="number">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 n√∫mero</span>
                  </div>
                  <div class="requirement" data-req="special">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 s√≠mbolo</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword" class="form-label">
                <span class="label-icon">üîí</span>
                <span class="label-text">Confirmar contrase√±a</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="password" 
                  id="confirmPassword"
                  name="confirmPassword" 
                  class="form-input" 
                  placeholder="Repite tu contrase√±a"
                  required
                  autocomplete="new-password"
                >
                <div class="input-validation" id="confirmValidation"></div>
                <div class="input-focus-border"></div>
              </div>
            </div>

            <button type="button" class="step-button" id="nextStep">
              <span class="btn-content">
                <span class="btn-text">Continuar</span>
                <span class="btn-icon">‚Üí</span>
              </span>
            </button>
          </div>

          <!-- Step 2: Verification & Terms -->
          <div class="form-step" id="step2">
            <div class="verification-section">
              <div class="verification-icon">üõ°Ô∏è</div>
              <h3 class="verification-title">¬°Casi terminamos!</h3>
              <p class="verification-text">
                Revisa tus datos y acepta nuestros t√©rminos para completar el registro.
              </p>
            </div>

            <!-- Data Summary -->
            <div class="data-summary">
              <div class="summary-item">
                <span class="summary-label">Usuario:</span>
                <span class="summary-value" id="summaryUsername">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Email:</span>
                <span class="summary-value" id="summaryEmail">-</span>
              </div>
            </div>

            <!-- Terms & Conditions -->
            <div class="terms-section">
              <label class="checkbox-wrapper terms-checkbox">
                <input type="checkbox" name="terms" class="checkbox-input" required>
                <span class="checkbox-custom"></span>
                <span class="checkbox-label">
                  Acepto los 
                  <a href="#" class="terms-link" target="_blank">t√©rminos y condiciones</a> 
                  y la 
                  <a href="#" class="terms-link" target="_blank">pol√≠tica de privacidad</a>
                </span>
              </label>

              <label class="checkbox-wrapper">
                <input type="checkbox" name="newsletter" class="checkbox-input">
                <span class="checkbox-custom"></span>
                <span class="checkbox-label">
                  Quiero recibir noticias y actualizaciones sobre entrenamientos
                </span>
              </label>
            </div>

            <!-- Action Buttons -->
            <div class="step-actions">
              <button type="button" class="step-button btn-ghost" id="prevStep">
                <span class="btn-content">
                  <span class="btn-icon">‚Üê</span>
                  <span class="btn-text">Atr√°s</span>
                </span>
              </button>
              
              <button type="submit" class="step-button btn-primary" id="submitForm">
                <span class="btn-content">
                  <span class="btn-text">Crear cuenta</span>
                  <span class="btn-icon">üöÄ</span>
                </span>
                <div class="btn-loading" id="btnLoading" aria-hidden="true">
                  <div class="loading-spinner"></div>
                  <span>Creando cuenta...</span>
                </div>
              </button>
            </div>
          </div>
        </form>

        <!-- Footer -->
        <div class="auth-footer">
          <p class="auth-footer-text">
            ¬øYa tienes cuenta? 
            <a href="{{ url_for('login') }}" class="auth-link">Inicia sesi√≥n aqu√≠</a>
          </p>
        </div>
      </div>

      <!-- Right Side - Info -->
      <div class="auth-info-container">
        <div class="info-content">
          <div class="info-badge">
            <span class="badge-icon">üéØ</span>
            <span class="badge-text">Tu futuro te espera</span>
          </div>
          
          <h2 class="info-title">√önete a miles de bomberos</h2>
          <p class="info-description">
            Forma parte de la comunidad m√°s grande de preparaci√≥n de oposiciones de bombero. 
            Acceso inmediato a contenido profesional y certificaciones oficiales.
          </p>

          <div class="info-features">
            <div class="feature-item">
              <div class="feature-icon">üß†</div>
              <div class="feature-content">
                <h4 class="feature-title">IA Especializada</h4>
                <p class="feature-desc">Entrenamiento personalizado con inteligencia artificial</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üìö</div>
              <div class="feature-content">
                <h4 class="feature-title">Sistema Leitner</h4>
                <p class="feature-desc">M√©todo cient√≠fico de repetici√≥n espaciada</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üèÜ</div>
              <div class="feature-content">
                <h4 class="feature-title">Certificaciones</h4>
                <p class="feature-desc">Reconocimiento oficial de tu progreso</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üë•</div>
              <div class="feature-content">
                <h4 class="feature-title">Comunidad</h4>
                <p class="feature-desc">Conecta con otros aspirantes y profesionales</p>
              </div>
            </div>
          </div>

          <div class="testimonial-preview">
            <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            <p class="testimonial-text">
              "FirefighterAI fue clave en mi preparaci√≥n. Aprob√© en el primer intento gracias a su sistema de IA."
            </p>
            <div class="testimonial-author">
              <div class="author-avatar">MC</div>
              <div class="author-info">
                <h5 class="author-name">Mar√≠a Carmen R.</h5>
                <p class="author-title">Bombera - Madrid</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.auth-layout -->
  </div><!-- /.container -->

  <!-- Status Messages -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="auth-notifications">
        {% for msg in messages %}
          <div class="notification error">
            <span class="notification-icon">‚ö†Ô∏è</span>
            <span class="notification-text">{{ msg }}</span>
            <button type="button" class="notification-close">‚úï</button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
</section>
{% endblock %}

{% block scripts %}
<style>
:root {
  --primary-red: #dc2626;
  --text-primary: #f8fafc;
  --text-secondary: #cbd5e1;
  --text-muted: #64748b;
  --text-accent: #fbbf24;
  --bg-primary: #0b0b0f;
  --bg-secondary: #1a1b23;
  --gradient-card: linear-gradient(145deg, rgba(26, 27, 35, 0.8), rgba(15, 16, 23, 0.9));
  --gradient-fire: linear-gradient(135deg, #dc2626, #f97316, #fbbf24);
  --radius-sm: 0.375rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.5rem;
  --radius-full: 9999px;
  --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.auth-background {
  position: fixed;
  inset: 0;
  z-index: -1;
  background: radial-gradient(ellipse at top right, rgba(245, 158, 11, 0.15), transparent 50%),
              radial-gradient(ellipse at bottom left, rgba(220, 38, 38, 0.1), transparent 50%);
}
.bg-gradient-overlay { position: absolute; inset: 0; background: linear-gradient(135deg, rgba(11,11,15,.7), rgba(11,11,15,.9)); }
.floating-particles { position: absolute; inset: 0; overflow: hidden; }
.particle { position: absolute; width: 3px; height: 3px; background: rgba(245,158,11,.4); border-radius: 50%; animation: float-up linear infinite; }
@keyframes float-up {
  0% { transform: translateY(100vh) translateX(0) scale(0); opacity: 0; }
  10% { opacity: 1; } 90% { opacity: 1; }
  100% { transform: translateY(-10vh) translateX(-20px) scale(1); opacity: 0; }
}

.auth-section { min-height: 100vh; display: flex; align-items: center; padding: 2rem 0; }
.auth-layout { display: grid; grid-template-columns: 1fr; gap: 2rem; max-width: 1200px; margin: 0 auto; }
@media (min-width: 1024px) { .auth-layout { grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; } }

.auth-form-container {
  background: var(--gradient-card);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: var(--radius-xl);
  padding: 2rem;
  backdrop-filter: blur(20px);
  box-shadow: 0 20px 40px rgba(0,0,0,.3);
  position: relative; overflow: hidden;
}
.auth-form-container::before { content:""; position:absolute; top:0; left:0; right:0; height:3px; background: var(--gradient-fire); }

.auth-header { text-align:center; margin-bottom:2rem; }
.auth-brand { display:flex; align-items:center; justify-content:center; gap:.5rem; margin-bottom:1rem; }
.brand-icon { font-size:2rem; filter: drop-shadow(0 0 10px rgba(245,158,11,.5)); }
.brand-text { font-size:1.5rem; font-weight:800; background:var(--gradient-fire); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
.auth-title { font-size:2rem; font-weight:700; color:var(--text-primary); margin-bottom:.5rem; }
.auth-subtitle { color:var(--text-secondary); font-size:1rem; }

.progress-indicator { display:flex; align-items:center; justify-content:center; margin-bottom:2rem; position:relative; }
.progress-step { display:flex; flex-direction:column; align-items:center; gap:.5rem; position:relative; z-index:2; }
.step-circle { width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,.1); border:2px solid rgba(255,255,255,.3); display:flex; align-items:center; justify-content:center; font-weight:700; color:var(--text-muted); transition: var(--transition-base); }
.progress-step.active .step-circle { background:var(--gradient-fire); border-color:var(--primary-red); color:#fff; box-shadow:0 0 20px rgba(220,38,38,.4); }
.step-label { font-size:.75rem; font-weight:600; color:var(--text-muted); text-transform:uppercase; letter-spacing:.05em; }
.progress-step.active .step-label { color:var(--text-primary); }
.progress-line { position:absolute; top:20px; left:50%; transform:translateX(-50%); width:100px; height:2px; background:rgba(255,255,255,.2); z-index:1; }
.progress-fill { height:100%; width:0%; background:var(--gradient-fire); transition: width .5s ease; }

.form-step { display:none; }
.form-step.active { display:block; animation: fade-in-up .6s ease-out; }
@keyframes fade-in-up { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

.auth-form { display:flex; flex-direction:column; }
.form-group { display:flex; flex-direction:column; gap:.5rem; margin-bottom:1.5rem; }
.form-label { display:flex; align-items:center; gap:.5rem; color:var(--text-primary); font-weight:600; font-size:.875rem; }
.label-required { color:var(--primary-red); font-size:1rem; }
.input-wrapper { position:relative; }
.form-input {
  width:100%; padding:1rem; background:rgba(255,255,255,.04);
  border:2px solid rgba(255,255,255,.1); border-radius:var(--radius-lg);
  color:var(--text-primary); font-size:1rem; transition: var(--transition-base);
  box-sizing: border-box;
}
.form-input::placeholder { color:var(--text-muted); }
.form-input:focus { outline:none; border-color: rgba(245,158,11,.5); background: rgba(255,255,255,.06); transform: translateY(-1px); }
.form-input.valid { border-color: rgba(34,197,94,.5); }
.form-input.invalid { border-color: rgba(239,68,68,.5); }

.input-focus-border { position:absolute; bottom:0; left:0; width:0; height:2px; background:var(--gradient-fire); border-radius:0 0 var(--radius-lg) var(--radius-lg); transition: width var(--transition-base); }
.form-input:focus + .password-toggle + .input-focus-border,
.form-input:focus + .input-validation + .input-focus-border,
.form-input:focus + .input-focus-border { width:100%; }

.input-validation { position:absolute; right:1rem; top:50%; transform:translateY(-50%); font-size:1.25rem; z-index:2; }
.input-validation.valid { color:#22c55e; }
.input-validation.invalid { color:#ef4444; }

.input-hint { font-size:.75rem; color:var(--text-muted); margin-top:.25rem; }

.password-toggle {
  position:absolute; right:1rem; top:50%; transform:translateY(-50%);
  background:none; border:none; color:var(--text-muted); cursor:pointer; padding:.5rem;
  border-radius: var(--radius-sm); transition: var(--transition-base); z-index:2;
}
.password-toggle:hover { color: var(--text-primary); background: rgba(255,255,255,.1); }

.password-strength {
  margin-top:1rem; padding:1rem; background:rgba(255,255,255,.03);
  border-radius: var(--radius-lg); border:1px solid rgba(255,255,255,.08);
}
.strength-bar { width:100%; height:4px; background:rgba(255,255,255,.1); border-radius: var(--radius-full); overflow:hidden; margin-bottom:.5rem; }
.strength-fill { height:100%; width:0%; background: var(--gradient-fire); border-radius: var(--radius-full); transition: var(--transition-base); }
.strength-text { font-size:.75rem; font-weight:600; color:var(--text-muted); margin-bottom:.75rem; text-transform:uppercase; letter-spacing:.05em; }
.strength-requirements { display:grid; grid-template-columns: 1fr 1fr; gap:.5rem; }
.requirement { display:flex; align-items:center; gap:.5rem; font-size:.75rem; }
.req-icon { color: var(--text-muted); font-weight:bold; }
.requirement.met .req-icon { color:#22c55e; }
.requirement.met .req-text { color: var(--text-secondary); }
.req-text { color: var(--text-muted); }

.step-button {
  position:relative; padding:1rem; background: var(--gradient-fire); border:none;
  border-radius: var(--radius-lg); color:#fff; font-weight:700; font-size:1rem; cursor:pointer;
  transition: var(--transition-base); overflow:hidden; width:100%; margin-top:1rem;
}
.step-button:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(245,158,11,.4); }
.step-button:disabled { opacity:.5; cursor:not-allowed; transform:none; }
.step-button.btn-ghost { background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.1); color: var(--text-primary); }
.step-button.btn-ghost:hover { background: rgba(255,255,255,.08); box-shadow: 0 5px 15px rgba(0,0,0,.2); }
.btn-content { display:flex; align-items:center; justify-content:center; gap:.5rem; }
.btn-loading { position:absolute; inset:0; display:none; align-items:center; justify-content:center; gap:.5rem; background: var(--gradient-fire); }
.loading-spinner { width:20px; height:20px; border:2px solid rgba(255,255,255,.3); border-top-color:#fff; border-radius:50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.verification-section { text-align:center; margin-bottom:2rem; }
.verification-icon { font-size:3rem; margin-bottom:1rem; filter: drop-shadow(0 0 10px rgba(245,158,11,.5)); }
.verification-title { font-size:1.5rem; font-weight:700; color:var(--text-primary); margin-bottom:.5rem; }
.verification-text { color: var(--text-secondary); line-height:1.6; }

.data-summary { background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius-lg); padding:1rem; margin-bottom:2rem; }
.summary-item { display:flex; justify-content:space-between; align-items:center; padding:.5rem 0; border-bottom:1px solid rgba(255,255,255,.05); }
.summary-item:last-child { border-bottom:none; }
.summary-label { color: var(--text-muted); font-weight:600; font-size:.875rem; }
.summary-value { color: var(--text-primary); font-weight:500; }

.terms-section { margin-bottom:2rem; }
.checkbox-wrapper { display:flex; align-items:flex-start; gap:.75rem; cursor:pointer; user-select:none; margin-bottom:1rem; }
.checkbox-wrapper:last-child { margin-bottom:0; }
.checkbox-input { position:absolute; opacity:0; }
.checkbox-custom { width:18px; height:18px; border:2px solid rgba(255,255,255,.3); border-radius: var(--radius-sm); background:transparent; transition: var(--transition-base); position:relative; flex-shrink:0; margin-top:2px; }
.checkbox-input:checked + .checkbox-custom { background: var(--gradient-fire); border-color: var(--primary-red); }
.checkbox-input:checked + .checkbox-custom::after { content:"‚úì"; position:absolute; top:50%; left:50%; transform: translate(-50%,-50%); color:#fff; font-weight:bold; font-size:.75rem; }
.checkbox-label { color: var(--text-secondary); font-size:.875rem; line-height:1.5; }
.terms-link { color: var(--primary-red); text-decoration: underline; font-weight:600; transition: color var(--transition-base); }
.terms-link:hover { color:#f97316; }

.step-actions { display:flex; gap:1rem; margin-top:2rem; }

.auth-info-container { display:none; flex-direction:column; justify-content:center; padding:2rem; }
@media (min-width:1024px){ .auth-info-container{ display:flex; } }
.info-content { text-align:center; }
.info-badge { display:inline-flex; align-items:center; gap:.5rem; padding:.5rem 1rem; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); border-radius: var(--radius-full); color: var(--text-secondary); font-size:.875rem; font-weight:600; margin-bottom:2rem; }
.info-title { font-size:2.5rem; font-weight:800; color:var(--text-primary); margin-bottom:1rem; line-height:1.2; }
.info-description { color: var(--text-secondary); font-size:1.125rem; line-height:1.6; margin-bottom:2rem; max-width:500px; margin-inline:auto; }
.info-features { display:flex; flex-direction:column; gap:1rem; margin-bottom:2rem; text-align:left; }
.feature-item { display:flex; gap:1rem; padding:1rem; background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius-lg); transition: var(--transition-base); }
.feature-item:hover { background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.15); transform: translateY(-2px); }
.feature-icon { font-size:1.5rem; flex-shrink:0; }
.feature-title { font-size:1rem; font-weight:700; color: var(--text-primary); margin-bottom:.25rem; }
.feature-desc { color: var(--text-secondary); font-size:.875rem; line-height:1.4; }

.testimonial-preview { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius-lg); padding:1.5rem; text-align:left; }
.testimonial-stars { font-size:1rem; margin-bottom:.75rem; }
.testimonial-text { color: var(--text-secondary); font-style: italic; line-height:1.6; margin-bottom:1rem; }
.testimonial-author { display:flex; align-items:center; gap:.75rem; }
.author-avatar { width:40px; height:40px; border-radius:50%; background: var(--gradient-fire); display:flex; align-items:center; justify-content:center; font-weight:700; color:#fff; font-size:.875rem; }
.author-name { font-size:.875rem; font-weight:600; color: var(--text-primary); margin:0; }
.author-title { font-size:.75rem; color: var(--text-muted); margin:0; }

.auth-footer { text-align:center; margin-top:1.5rem; }
.auth-footer-text { color: var(--text-secondary); font-size:.875rem; }
.auth-link { color: var(--primary-red); font-weight:600; transition: color var(--transition-base); }
.auth-link:hover { color:#f97316; }

.auth-notifications { position:fixed; top:2rem; right:2rem; z-index:1000; max-width:400px; }
.notification { display:flex; align-items:center; gap:.75rem; padding:1rem; background: var(--bg-secondary); border:1px solid rgba(239,68,68,.3); border-radius: var(--radius-lg); box-shadow: 0 10px 30px rgba(0,0,0,.3); margin-bottom:.75rem; animation: slide-in-right .5s ease-out; }
.notification.error { border-color: rgba(239,68,68,.4); background: rgba(239,68,68,.05); }
.notification-icon { font-size:1.25rem; flex-shrink:0; }
.notification-text { color: var(--text-primary); font-weight:500; flex:1; }
.notification-close { background:none; border:none; color: var(--text-muted); cursor:pointer; font-size:1.25rem; padding:.25rem; border-radius: var(--radius-sm); transition: var(--transition-base); }
.notification-close:hover { background: rgba(255,255,255,.1); color: var(--text-primary); }
@keyframes slide-in-right { from { opacity:0; transform: translateX(100%);} to { opacity:1; transform: translateX(0);} }

@media (max-width: 768px) {
  .auth-section { padding: 1rem 0; }
  .auth-form-container { padding: 1.5rem; }
  .auth-title { font-size: 1.75rem; }
  .info-title { font-size: 2rem; }
  .step-actions { flex-direction: column; }
  .strength-requirements { grid-template-columns: 1fr; }
  .progress-line { width: 80px; }
  .auth-notifications { right:1rem; left:1rem; max-width:none; }
}
@media (max-width: 480px) {
  .auth-form-container { padding: 1rem; }
  .progress-indicator { transform: scale(0.9); }
  .testimonial-preview { padding: 1rem; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const form = document.getElementById('registerForm');
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const nextBtn = document.getElementById('nextStep');
  const prevBtn = document.getElementById('prevStep');
  const submitBtn = document.getElementById('submitForm');

  const progressSteps = document.querySelectorAll('.progress-step');
  const progressFill = document.getElementById('progressFill');

  const usernameInput = document.getElementById('username');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const confirmPasswordInput = document.getElementById('confirmPassword');
  const togglePassword = document.getElementById('togglePassword');

  const usernameValidation = document.getElementById('usernameValidation');
  const emailValidation = document.getElementById('emailValidation');
  const confirmValidation = document.getElementById('confirmValidation');

  const summaryUsername = document.getElementById('summaryUsername');
  const summaryEmail = document.getElementById('summaryEmail');

  const strengthFill = document.getElementById('strengthFill');
  const requirements = document.querySelectorAll('.requirement');

  let currentStep = 1;

  // Helpers
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  function updateStep(step) {
    progressSteps.forEach((el, idx) => {
      if (idx + 1 <= step) el.classList.add('active'); else el.classList.remove('active');
    });
    progressFill.style.width = (step === 1 ? 0 : 100) + '%';

    if (step === 1) {
      step1.classList.add('active');
      step2.classList.remove('active');
    } else {
      step1.classList.remove('active');
      step2.classList.add('active');
      // Summary
      summaryUsername.textContent = usernameInput.value || '-';
      summaryEmail.textContent = emailInput.value || '-';
    }
    currentStep = step;
  }

  function validateStep1() {
    const u = (usernameInput.value || '').trim();
    const e = (emailInput.value || '').trim();
    const p = passwordInput.value || '';
    const c = confirmPasswordInput.value || '';

    const userOk = /^[a-zA-Z0-9]{3,24}$/.test(u);
    const emailOk = emailRegex.test(e);
    const passOk = p.length >= 8 && /[A-Z]/.test(p) && /\d/.test(p) && /[!@#$%^&*(),.?":{}|<>]/.test(p);
    const confirmOk = c.length > 0 && c === p;

    return userOk && emailOk && passOk && confirmOk;
  }

  function updateNextButton() {
    if (nextBtn) nextBtn.disabled = !validateStep1();
  }

  // Password toggle
  if (togglePassword && passwordInput) {
    togglePassword.addEventListener('click', () => {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      const icon = togglePassword.querySelector('.toggle-icon');
      if (icon) icon.textContent = (type === 'password') ? 'üëÅÔ∏è' : 'üôà';
    });
  }

  // Username validation
  if (usernameInput) {
    usernameInput.addEventListener('input', () => {
      const v = usernameInput.value.trim();
      const ok = /^[a-zA-Z0-9]{3,24}$/.test(v);
      usernameInput.classList.toggle('valid', ok);
      usernameInput.classList.toggle('invalid', v.length > 0 && !ok);
      if (usernameValidation) {
        usernameValidation.textContent = v.length === 0 ? '' : (ok ? '‚úì' : '‚úó');
        usernameValidation.className = 'input-validation ' + (ok ? 'valid' : 'invalid');
        if (v.length === 0) usernameValidation.className = 'input-validation';
      }
      updateNextButton();
    });
  }

  // Email validation
  if (emailInput) {
    emailInput.addEventListener('input', () => {
      const v = emailInput.value.trim();
      const ok = emailRegex.test(v);
      emailInput.classList.toggle('valid', ok);
      emailInput.classList.toggle('invalid', v.length > 0 && !ok);
      if (emailValidation) {
        emailValidation.textContent = v.length === 0 ? '' : (ok ? '‚úì' : '‚úó');
        emailValidation.className = 'input-validation ' + (ok ? 'valid' : 'invalid');
        if (v.length === 0) emailValidation.className = 'input-validation';
      }
      updateNextButton();
    });
  }

  // Password strength
  if (passwordInput && strengthFill && requirements) {
    passwordInput.addEventListener('input', () => {
      const v = passwordInput.value;
      const checks = {
        length: v.length >= 8,
        uppercase: /[A-Z]/.test(v),
        number: /\d/.test(v),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(v)
      };
      let score = 0;
      requirements.forEach(req => {
        const k = req.getAttribute('data-req');
        const met = !!checks[k];
        req.classList.toggle('met', met);
        const icon = req.querySelector('.req-icon');
        if (icon) icon.textContent = met ? '‚óè' : '‚óã';
        score += met ? 1 : 0;
      });
      const pct = (score / 4) * 100;
      strengthFill.style.width = pct + '%';
      if (score === 4) {
        strengthFill.style.background = '#22c55e';
        passwordInput.classList.add('valid'); passwordInput.classList.remove('invalid');
      } else if (score >= 2) {
        strengthFill.style.background = '#f59e0b';
        passwordInput.classList.remove('valid','invalid');
      } else {
        strengthFill.style.background = '#ef4444';
        passwordInput.classList.add('invalid'); passwordInput.classList.remove('valid');
      }
      updateNextButton();
    });
  }

  // Confirm password
  if (confirmPasswordInput && confirmValidation && passwordInput) {
    confirmPasswordInput.addEventListener('input', () => {
      const ok = confirmPasswordInput.value.length > 0 && confirmPasswordInput.value === passwordInput.value;
      confirmPasswordInput.classList.toggle('valid', ok);
      confirmPasswordInput.classList.toggle('invalid', !ok && confirmPasswordInput.value.length > 0);
      confirmValidation.textContent = confirmPasswordInput.value.length === 0 ? '' : (ok ? '‚úì' : '‚úó');
      confirmValidation.className = 'input-validation ' + (ok ? 'valid' : 'invalid');
      if (confirmPasswordInput.value.length === 0) confirmValidation.className = 'input-validation';
      updateNextButton();
    });
  }

  // Next step
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      if (validateStep1()) {
        updateStep(2);
      } else {
        // Shake invalids
        const invalids = document.querySelectorAll('.form-input.invalid, .form-input:not(.valid)');
        invalids.forEach(el => {
          el.style.animation = 'shake 0.5s ease-in-out';
          setTimeout(() => el.style.animation = '', 500);
        });
      }
    });
    updateNextButton();
  }

  // Previous step
  if (prevBtn) {
    prevBtn.addEventListener('click', () => updateStep(1));
  }

  // Terms enable/disable submit
  const termsCheckbox = document.querySelector('input[name="terms"]');
  if (termsCheckbox && submitBtn) {
    submitBtn.disabled = !termsCheckbox.checked;
    termsCheckbox.addEventListener('change', () => {
      submitBtn.disabled = !termsCheckbox.checked;
    });
  }

  // Submit loading state (deja que el form haga POST normal al backend)
  if (form && submitBtn) {
    form.addEventListener('submit', () => {
      const btnContent = submitBtn.querySelector('.btn-content');
      const btnLoading = document.getElementById('btnLoading');
      if (btnContent && btnLoading) {
        btnContent.style.display = 'none';
        btnLoading.style.display = 'flex';
        submitBtn.disabled = true;
      }
    });
  }

  // Notifs close + autohide
  document.querySelectorAll('.notification-close').forEach(btn => {
    btn.addEventListener('click', function(){
      const n = this.parentElement;
      n.style.opacity = '0';
      n.style.transform = 'translateX(100%)';
      setTimeout(() => n.remove(), 300);
    });
  });
  setTimeout(() => {
    document.querySelectorAll('.notification').forEach(n => {
      n.style.opacity = '0';
      n.style.transform = 'translateX(100%)';
      setTimeout(() => n.remove(), 300);
    });
  }, 5000);

  // Shake keyframes (injected)
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%,100%{transform:translateX(0)}
      10%,30%,50%,70%,90%{transform:translateX(-3px)}
      20%,40%,60%,80%{transform:translateX(3px)}
    }
  `;
  document.head.appendChild(style);
});
</script>
{% endblock %}
