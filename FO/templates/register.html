{% extends "layout.html" %}

{% block title %}Crear Cuenta - Onfire AI{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/sso-components.css') }}">
{% endblock %}

{% block content %}
<!-- Background Effects -->
<div class="auth-background">
  <div class="bg-gradient-overlay"></div>
  <div class="floating-particles">
    {% for i in range(20) %}
    <div class="particle" style="
      left: {{ range(0, 100) | random }}%;
      animation-delay: {{ range(0, 500) | random / 100 }}s;
      animation-duration: {{ range(500, 900) | random / 100 }}s;
    "></div>
    {% endfor %}
  </div>
</div>

<!-- Auth Container -->
<section class="auth-section">
  <div class="container">
    <div class="auth-layout">

      <!-- Left Side - Form -->
      <div class="auth-form-container">
        <!-- Header -->
        <div class="auth-header">
          <div class="auth-brand">
            <div class="brand-icon">üöÄ</div>
            <div class="brand-text">Onfire AI</div>
          </div>
          <h1 class="auth-title">√önete al equipo</h1>
          <p class="auth-subtitle">Comienza tu preparaci√≥n profesional hoy mismo</p>
        </div>

        <!-- SSO Buttons (Quick Registration) -->
        <div class="sso-buttons-top">
          <button type="button" class="sso-btn sso-google" id="googleRegisterBtn" aria-label="Registrarse con Google">
            <svg class="sso-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
            </svg>
            <span class="sso-text">Continuar con Google</span>
          </button>

          <button type="button" class="sso-btn sso-facebook" id="facebookRegisterBtn" aria-label="Registrarse con Facebook">
            <svg class="sso-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="#1877F2"/>
            </svg>
            <span class="sso-text">Continuar con Facebook</span>
          </button>
        </div>

        <!-- Divider -->
        <div class="auth-divider">
          <span class="divider-line"></span>
          <span class="divider-text">O reg√≠strate con email</span>
          <span class="divider-line"></span>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-step active" data-step="1">
            <div class="step-circle">1</div>
            <span class="step-label">Datos b√°sicos</span>
          </div>
          <div class="progress-line">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-step" data-step="2">
            <div class="step-circle">2</div>
            <span class="step-label">Verificaci√≥n</span>
          </div>
        </div>

        <!-- Form -->
        <form method="POST" class="auth-form" id="registerForm" novalidate>
          <!-- Step 1: Basic Information -->
          <div class="form-step active" id="step1">
            <div class="form-group">
              <label for="username" class="form-label">
                <span class="label-icon">üë§</span>
                <span class="label-text">Usuario</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input type="text" id="username" name="username" class="form-input"
                  placeholder="Elige tu nombre de usuario" required autocomplete="username" minlength="3" maxlength="24"
                  pattern="[a-zA-Z0-9]+" title="Solo letras y n√∫meros, entre 3-24 caracteres">
                <div class="input-validation" id="usernameValidation"></div>
                <div class="input-focus-border"></div>
              </div>
              <div class="input-hint">M√≠nimo 3 caracteres, solo letras y n√∫meros</div>
            </div>

            <div class="form-group">
              <label for="email" class="form-label">
                <span class="label-icon">üìß</span>
                <span class="label-text">Email</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input type="email" id="email" name="email" class="form-input" placeholder="tu.email@ejemplo.com"
                  required autocomplete="email">
                <div class="input-validation" id="emailValidation"></div>
                <div class="input-focus-border"></div>
              </div>
              <div class="input-hint">Usa un email v√°lido para recuperar tu cuenta</div>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">
                <span class="label-icon">üîë</span>
                <span class="label-text">Contrase√±a</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input type="password" id="password" name="password" class="form-input"
                  placeholder="Crea una contrase√±a segura" required autocomplete="new-password" minlength="8">
                <button type="button" class="password-toggle" id="togglePassword"
                  aria-label="Mostrar u ocultar contrase√±a">
                  <span class="toggle-icon">üëÅÔ∏è</span>
                </button>
                <div class="input-focus-border"></div>
              </div>

              <!-- Password Strength Indicator -->
              <div class="password-strength" id="passwordStrength">
                <div class="strength-bar">
                  <div class="strength-fill" id="strengthFill"></div>
                </div>
                <div class="strength-text">Fortaleza de la contrase√±a</div>
                <div class="strength-requirements">
                  <div class="requirement" data-req="length">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">M√≠nimo 8 caracteres</span>
                  </div>
                  <div class="requirement" data-req="uppercase">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 may√∫scula</span>
                  </div>
                  <div class="requirement" data-req="number">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 n√∫mero</span>
                  </div>
                  <div class="requirement" data-req="special">
                    <span class="req-icon">‚óã</span>
                    <span class="req-text">Al menos 1 s√≠mbolo</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword" class="form-label">
                <span class="label-icon">üîí</span>
                <span class="label-text">Confirmar contrase√±a</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input type="password" id="confirmPassword" name="confirmPassword" class="form-input"
                  placeholder="Repite tu contrase√±a" required autocomplete="new-password">
                <div class="input-validation" id="confirmValidation"></div>
                <div class="input-focus-border"></div>
              </div>
            </div>

            <div class="form-group">
              <label for="access_token" class="form-label">
                <span class="label-icon">üîë</span>
                <span class="label-text">Token de Acceso</span>
                <span class="label-required">*</span>
              </label>
              <div class="input-wrapper">
                <input type="text" id="access_token" name="access_token" class="form-input"
                  placeholder="Ingresa tu token de acceso" required autocomplete="off">
                <div class="input-validation" id="tokenValidation"></div>
                <div class="input-focus-border"></div>
              </div>
              <div class="input-hint">Token requerido para crear una cuenta. Sin token no podr√°s registrarte.</div>
            </div>

            <button type="button" class="step-button" id="nextStep">
              <span class="btn-content">
                <span class="btn-text">Continuar</span>
                <span class="btn-icon">‚Üí</span>
              </span>
            </button>
          </div>

          <!-- Step 2: Verification & Terms -->
          <div class="form-step" id="step2">
            <div class="verification-section">
              <div class="verification-icon">üõ°Ô∏è</div>
              <h3 class="verification-title">¬°Casi terminamos!</h3>
              <p class="verification-text">
                Revisa tus datos y acepta nuestros t√©rminos para completar el registro.
              </p>
            </div>

            <!-- Data Summary -->
            <div class="data-summary">
              <div class="summary-item">
                <span class="summary-label">Usuario:</span>
                <span class="summary-value" id="summaryUsername">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Email:</span>
                <span class="summary-value" id="summaryEmail">-</span>
              </div>
            </div>

            <!-- Terms & Conditions -->
            <div class="terms-section">
              <label class="checkbox-wrapper terms-checkbox">
                <input type="checkbox" name="terms" class="checkbox-input" required>
                <span class="checkbox-custom"></span>
                <span class="checkbox-label">
                  Acepto los
                  <a href="#" class="terms-link" target="_blank">t√©rminos y condiciones</a>
                  y la
                  <a href="#" class="terms-link" target="_blank">pol√≠tica de privacidad</a>
                </span>
              </label>

              <label class="checkbox-wrapper">
                <input type="checkbox" name="newsletter" class="checkbox-input">
                <span class="checkbox-custom"></span>
                <span class="checkbox-label">
                  Quiero recibir noticias y actualizaciones sobre entrenamientos
                </span>
              </label>
            </div>

            <!-- Action Buttons -->
            <div class="step-actions">
              <button type="button" class="step-button btn-ghost" id="prevStep">
                <span class="btn-content">
                  <span class="btn-icon">‚Üê</span>
                  <span class="btn-text">Atr√°s</span>
                </span>
              </button>

              <button type="submit" class="step-button btn-primary" id="submitForm">
                <span class="btn-content">
                  <span class="btn-text">Crear cuenta</span>
                  <span class="btn-icon">üöÄ</span>
                </span>
                <div class="btn-loading" id="btnLoading" aria-hidden="true">
                  <div class="loading-spinner"></div>
                  <span>Creando cuenta...</span>
                </div>
              </button>
            </div>
          </div>
        </form>

        <!-- Footer -->
        <div class="auth-footer">
          <p class="auth-footer-text">
            ¬øYa tienes cuenta?
            <a href="{{ url_for('login') }}" class="auth-link">Inicia sesi√≥n aqu√≠</a>
          </p>
        </div>
      </div>

      <!-- Right Side - Info -->
      <div class="auth-info-container">
        <div class="info-content">
          <div class="info-badge">
            <span class="badge-icon">üéØ</span>
            <span class="badge-text">Tu futuro te espera</span>
          </div>

          <h2 class="info-title">√önete a miles de bomberos</h2>
          <p class="info-description">
            Forma parte de la comunidad m√°s grande de preparaci√≥n de oposiciones de bombero.
            Acceso inmediato a contenido profesional y certificaciones oficiales.
          </p>

          <div class="info-features">
            <div class="feature-item">
              <div class="feature-icon">üß†</div>
              <div class="feature-content">
                <h4 class="feature-title">IA Especializada</h4>
                <p class="feature-desc">Entrenamiento personalizado con inteligencia artificial</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üìö</div>
              <div class="feature-content">
                <h4 class="feature-title">Sistema Leitner</h4>
                <p class="feature-desc">M√©todo cient√≠fico de repetici√≥n espaciada</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üèÜ</div>
              <div class="feature-content">
                <h4 class="feature-title">Certificaciones</h4>
                <p class="feature-desc">Reconocimiento oficial de tu progreso</p>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon">üë•</div>
              <div class="feature-content">
                <h4 class="feature-title">Comunidad</h4>
                <p class="feature-desc">Conecta con otros aspirantes y profesionales</p>
              </div>
            </div>
          </div>

          <div class="testimonial-preview">
            <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
            <p class="testimonial-text">
              "Onfire AI fue clave en mi preparaci√≥n. Aprob√© en el primer intento gracias a su sistema de IA."
            </p>
            <div class="testimonial-author">
              <div class="author-avatar">MC</div>
              <div class="author-info">
                <h5 class="author-name">Mar√≠a Carmen R.</h5>
                <p class="author-title">Bombera - Madrid</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.auth-layout -->
  </div><!-- /.container -->

  <!-- Status Messages -->
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="auth-notifications">
    {% for msg in messages %}
    <div class="notification error">
      <span class="notification-icon">‚ö†Ô∏è</span>
      <span class="notification-text">{{ msg }}</span>
      <button type="button" class="notification-close">‚úï</button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/sso-handler.js') }}"></script>
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}