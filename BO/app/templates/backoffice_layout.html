<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}FirefighterAI BackOffice{% endblock %}</title>
  <meta name="description" content="Panel de administraciÃ³n FirefighterAI">
  <meta name="theme-color" content="#0f172a">

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- CSS Base del layout -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  
  <!-- CSS especÃ­fico de cada pÃ¡gina -->
  {% block styles %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">
  <div class="layout {% if not current_user.is_authenticated %}login-layout{% else %}dashboard-layout{% endif %}">
    
    <!-- SIDEBAR - Solo visible cuando estÃ¡ logueado -->
    {% if current_user.is_authenticated %}
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="brand-icon">ğŸ”¥</div>
          <div class="brand-text">FirefighterAI</div>
          <div class="brand-subtitle">BackOffice</div>
        </div>
        <button class="sidebar-toggle" id="sidebarToggle">
          <span class="toggle-icon">â†</span>
        </button>
      </div>

      <nav class="sidebar-nav">
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="{{ url_for('dashboard.index') }}" class="nav-link {% if request.endpoint == 'dashboard.index' %}active{% endif %}">
              <span class="nav-icon">ğŸ“Š</span>
              <span class="nav-text">Dashboard</span>
            </a>
          </li>
          
          <li class="nav-item">
            <a href="{{ url_for('users.user_list') }}" class="nav-link {% if 'users' in request.endpoint %}active{% endif %}">
              <span class="nav-icon">ğŸ‘¥</span>
              <span class="nav-text">Usuarios</span>
            </a>
          </li>
          
          <li class="nav-item">
            <a href="{{ url_for('memory_cards.card_list') }}" class="nav-link {% if 'memory_cards' in request.endpoint %}active{% endif %}">
              <span class="nav-icon">ğŸ—ƒï¸</span>
              <span class="nav-text">Memory Cards</span>
            </a>
          </li>
          
          <li class="nav-divider">
            <span class="divider-text">Sistema</span>
          </li>
          
          <li class="nav-item">
            <a href="{{ url_for('auth.setup_mfa') }}" class="nav-link {% if 'mfa' in request.endpoint %}active{% endif %}">
              <span class="nav-icon">ğŸ›¡ï¸</span>
              <span class="nav-text">Seguridad</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Usuario en sidebar -->
      <div class="sidebar-user">
        <div class="user-avatar">{{ current_user.username[0]|upper }}</div>
        <div class="user-info">
          <div class="user-name">{{ current_user.username }}</div>
          <div class="user-role">{{ current_user.role|title }}</div>
        </div>
        <div class="user-actions">
          <a href="{{ url_for('auth.logout') }}" class="user-action" title="Cerrar sesiÃ³n">
            <span class="action-icon">ğŸšª</span>
          </a>
        </div>
      </div>
    </aside>
    {% endif %}

    <!-- MAIN CONTENT -->
    <main class="main-content">
      
      <!-- HEADER - Solo visible cuando estÃ¡ logueado -->
      {% if current_user.is_authenticated %}
      <header class="top-header">
        <div class="header-left">
          <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
          </button>
          
          <div class="page-title">
            {% block page_title %}Dashboard{% endblock %}
          </div>
        </div>

        <div class="header-right">
          <div class="header-actions">
            <button class="header-btn" onclick="refreshData()" title="Actualizar">
              <span class="btn-icon">ğŸ”„</span>
            </button>
          </div>

          <!-- User menu -->
          <div class="user-menu">
            <button class="user-menu-trigger" onclick="toggleUserMenu()">
              <div class="user-avatar-sm">{{ current_user.username[0]|upper }}</div>
              <span class="user-name-sm">{{ current_user.username }}</span>
              <span class="dropdown-arrow">â–¼</span>
            </button>
            
            <div class="user-menu-dropdown" id="userMenuDropdown">
              <div class="user-menu-header">
                <div class="user-avatar">{{ current_user.username[0]|upper }}</div>
                <div class="user-details">
                  <div class="user-name">{{ current_user.username }}</div>
                  <div class="user-email">{{ current_user.email }}</div>
                </div>
              </div>
              
              <div class="user-menu-actions">
                <a href="{{ url_for('auth.setup_mfa') }}" class="user-menu-item">
                  <span class="menu-icon">âš™ï¸</span>
                  <span class="menu-text">ConfiguraciÃ³n</span>
                </a>
                <a href="{{ url_for('auth.logout') }}" class="user-menu-item logout">
                  <span class="menu-icon">ğŸšª</span>
                  <span class="menu-text">Cerrar SesiÃ³n</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>
      {% endif %}

      <!-- FLASH MESSAGES -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash flash-{{ category }}" data-flash>
                <div class="flash-icon">
                  {% if category == 'error' %}âŒ
                  {% elif category == 'warning' %}âš ï¸
                  {% elif category == 'success' %}âœ…
                  {% else %}â„¹ï¸{% endif %}
                </div>
                <div class="flash-content">{{ message }}</div>
                <button class="flash-close" onclick="this.parentElement.remove()">âœ•</button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- PAGE CONTENT -->
      <div class="page-content">
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

  <!-- JavaScript base del layout -->
  <script src="{{ url_for('static', filename='js/layout.js') }}"></script>
  
  <!-- JavaScript especÃ­fico de cada pÃ¡gina -->
  {% block scripts %}{% endblock %}
</body>
</html>