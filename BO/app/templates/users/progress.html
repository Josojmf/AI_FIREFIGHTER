<!-- app/templates/users/progress.html - RESPONSIVE PROGRESS ANALYTICS COMPLETO -->
{% extends "backoffice_layout.html" %}

{% block title %}Progreso de {{ user.username }} - FirefighterAI BackOffice{% endblock %}
{% block page_title %}Progreso Detallado{% endblock %}

{% block content %}
<div class="progress-analytics">
  <!-- Navegaci√≥n -->
  <div class="back-navigation">
    <a href="{{ url_for('users.user_detail', user_id=user.id) }}" class="btn-back">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Volver a Usuario</span>
    </a>
  </div>

  <!-- Header del progreso -->
  <div class="progress-header">
    <div class="user-summary">
      <div class="user-info">
        <div class="user-avatar">{{ user.username[0]|upper }}</div>
        <div class="user-details">
          <h1>{{ user.username }}</h1>
          <p>{{ user.email }}</p>
          <span class="role-badge role-{{ user.role }}">{{ user.role|title }}</span>
        </div>
      </div>
      
      {% if progress %}
      <div class="progress-overview">
        <div class="overview-stat highlight">
          <div class="stat-icon">üéØ</div>
          <div class="stat-data">
            <h3>{{ progress.general_stats.total_cards }}</h3>
            <p>Total Cards</p>
          </div>
        </div>
        <div class="overview-stat">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-data">
            <h3>{{ progress.general_stats.accuracy_rate }}%</h3>
            <p>Precisi√≥n</p>
          </div>
        </div>
        <div class="overview-stat">
          <div class="stat-icon">üî•</div>
          <div class="stat-data">
            <h3>{{ progress.general_stats.study_streak }}</h3>
            <p>Racha de Estudio</p>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  {% if progress %}
  <div class="progress-content">
    
    <!-- M√©tricas principales -->
    <section class="main-metrics">
      <h2>üìä M√©tricas Principales</h2>
      <div class="metrics-grid">
        <div class="metric-card primary">
          <div class="metric-header">
            <div class="metric-icon">üéØ</div>
            <h3>Total Estudiadas</h3>
          </div>
          <div class="metric-value">{{ progress.general_stats.total_cards }}</div>
          <div class="metric-trend positive">+12% esta semana</div>
        </div>
        
        <div class="metric-card success">
          <div class="metric-header">
            <div class="metric-icon">‚úÖ</div>
            <h3>Correctas</h3>
          </div>
          <div class="metric-value">{{ progress.general_stats.correct_answers }}</div>
          <div class="metric-progress">
            {% set accuracy = progress.general_stats.accuracy_rate %}
            <div class="progress-ring" style="--progress: {{ accuracy }}%;">
              <span>{{ accuracy }}%</span>
            </div>
          </div>
        </div>
        
        <div class="metric-card warning">
          <div class="metric-header">
            <div class="metric-icon">‚ùå</div>
            <h3>Incorrectas</h3>
          </div>
          <div class="metric-value">{{ progress.general_stats.incorrect_answers }}</div>
          <div class="metric-trend negative">-5% vs anterior</div>
        </div>
        
        <div class="metric-card info">
          <div class="metric-header">
            <div class="metric-icon">üìù</div>
            <h3>Reviews Total</h3>
          </div>
          <div class="metric-value">{{ progress.general_stats.total_reviews }}</div>
          <div class="metric-subtitle">{{ (progress.general_stats.total_reviews / progress.general_stats.total_cards * 1.0) | round(1) }} promedio por card</div>
        </div>
      </div>
    </section>

    <!-- An√°lisis de precisi√≥n detallado -->
    <section class="accuracy-analysis">
      <h2>üéØ An√°lisis de Precisi√≥n</h2>
      <div class="analysis-container">
        <div class="accuracy-chart">
          <div class="chart-header">
            <h3>Distribuci√≥n de Respuestas</h3>
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color correct"></span>
                <span>Correctas ({{ progress.general_stats.correct_answers }})</span>
              </div>
              <div class="legend-item">
                <span class="legend-color incorrect"></span>
                <span>Incorrectas ({{ progress.general_stats.incorrect_answers }})</span>
              </div>
            </div>
          </div>
          <div class="pie-chart">
            {% set total_answers = progress.general_stats.correct_answers + progress.general_stats.incorrect_answers %}
            {% set correct_percentage = (progress.general_stats.correct_answers / total_answers * 100) if total_answers > 0 else 0 %}
            {% set incorrect_percentage = 100 - correct_percentage %}
            <div class="pie" style="--correct: {{ correct_percentage }}%; --incorrect: {{ incorrect_percentage }}%;">
              <div class="pie-center">
                <span class="pie-value">{{ "%.1f"|format(correct_percentage) }}%</span>
                <span class="pie-label">Precisi√≥n</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accuracy-stats">
          <div class="stat-row">
            <span class="stat-label">Mejor racha de aciertos:</span>
            <span class="stat-value">{{ progress.general_stats.best_streak or 0 }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Racha actual:</span>
            <span class="stat-value">{{ progress.general_stats.study_streak }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Tiempo promedio por card:</span>
            <span class="stat-value">{{ progress.general_stats.avg_time_per_card or "N/A" }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">√öltima sesi√≥n:</span>
            <span class="stat-value">{{ progress.general_stats.last_study_date or "No disponible" }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Sistema Leitner detallado -->
    <section class="leitner-system">
      <h2>üì¶ Sistema Leitner - Distribuci√≥n Inteligente</h2>
      <div class="leitner-explanation">
        <p>El sistema Leitner organiza las cards seg√∫n tu nivel de dominio. Las cards que respondes correctamente avanzan a cajas superiores, mientras que los errores las env√≠an de vuelta al inicio.</p>
      </div>
      
      <div class="leitner-visualization">
        <div class="leitner-flow">
          {% for i in range(1, 7) %}
          <div class="leitner-box-detailed box-{{ i }}">
            <div class="box-header">
              <div class="box-number">{{ i }}</div>
              <div class="box-info">
                <h4>Box {{ i }}</h4>
                <p>
                  {% if i == 1 %}Nuevas & Errores{% endif %}
                  {% if i == 2 %}1 d√≠a{% endif %}
                  {% if i == 3 %}3 d√≠as{% endif %}
                  {% if i == 4 %}1 semana{% endif %}
                  {% if i == 5 %}2 semanas{% endif %}
                  {% if i == 6 %}1 mes+{% endif %}
                </p>
              </div>
            </div>
            
            <div class="box-content">
              {% set count = progress.leitner_distribution[i-1] if progress.leitner_distribution and i-1 < progress.leitner_distribution|length else 0 %}
              <div class="box-count">{{ count }}</div>
              <div class="box-percentage">
                {% set total = progress.general_stats.total_cards %}
                {% set percentage = (count / total * 100) if total > 0 else 0 %}
                {{ "%.1f"|format(percentage) }}%
              </div>
            </div>
            
            <div class="box-progress">
              <div class="progress-bar-vertical">
                <div class="progress-fill-vertical" style="height: {{ percentage }}%"></div>
              </div>
            </div>
            
            {% if i < 6 %}
            <div class="box-arrow">‚Üí</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        
        <div class="leitner-insights">
          <h4>üí° Insights del Sistema Leitner</h4>
          <div class="insights-grid">
            <div class="insight-card">
              <div class="insight-icon">üéØ</div>
              <div class="insight-content">
                <h5>Dominio Avanzado</h5>
                {% set advanced = (progress.leitner_distribution[4] + progress.leitner_distribution[5]) if progress.leitner_distribution and len(progress.leitner_distribution) >= 6 else 0 %}
                <p>{{ advanced }} cards en cajas 5-6 (dominio alto)</p>
              </div>
            </div>
            
            <div class="insight-card">
              <div class="insight-icon">üìö</div>
              <div class="insight-content">
                <h5>En Aprendizaje</h5>
                {% set learning = (progress.leitner_distribution[1] + progress.leitner_distribution[2]) if progress.leitner_distribution and len(progress.leitner_distribution) >= 3 else 0 %}
                <p>{{ learning }} cards en proceso de consolidaci√≥n</p>
              </div>
            </div>
            
            <div class="insight-card">
              <div class="insight-icon">üîÑ</div>
              <div class="insight-content">
                <h5>Necesitan Repaso</h5>
                {% set review_needed = progress.leitner_distribution[0] if progress.leitner_distribution and len(progress.leitner_distribution) >= 1 else 0 %}
                <p>{{ review_needed }} cards requieren atenci√≥n inmediata</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Progreso por categor√≠as -->
    <section class="category-progress">
      <h2>üìÇ Progreso por Categor√≠as</h2>
      {% if progress.categories %}
      <div class="categories-list">
        {% for category in progress.categories %}
        <div class="category-card">
          <div class="category-header">
            <div class="category-info">
              <h4>{{ category.name }}</h4>
              <p>{{ category.description or "Sin descripci√≥n" }}</p>
            </div>
            <div class="category-stats">
              <div class="accuracy-badge accuracy-{{ 'high' if category.accuracy > 80 else 'medium' if category.accuracy > 60 else 'low' }}">
                {{ category.accuracy }}%
              </div>
            </div>
          </div>
          
          <div class="category-details">
            <div class="detail-row">
              <span>Total estudiadas:</span>
              <span>{{ category.total_cards }}</span>
            </div>
            <div class="detail-row">
              <span>Correctas:</span>
              <span class="text-success">{{ category.correct }}</span>
            </div>
            <div class="detail-row">
              <span>Incorrectas:</span>
              <span class="text-error">{{ category.incorrect }}</span>
            </div>
            <div class="detail-row">
              <span>√öltima actividad:</span>
              <span>{{ category.last_activity or "No disponible" }}</span>
            </div>
          </div>
          
          <div class="category-progress-bar">
            <div class="progress-fill" style="width: {{ category.accuracy }}%"></div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="no-categories">
        <div class="empty-icon">üìÇ</div>
        <p>No hay datos de categor√≠as disponibles</p>
      </div>
      {% endif %}
    </section>

    <!-- Actividad reciente -->
    <section class="recent-activity">
      <h2>üìà Actividad de Estudio</h2>
      <div class="activity-container">
        <div class="activity-chart">
          <h3>√öltimos 7 d√≠as</h3>
          <div class="chart-container">
            <div class="bar-chart">
              {% for day in range(7) %}
              <div class="chart-bar">
                <div class="bar-fill" style="height: {{ range(20, 80) | random }}%"></div>
                <div class="bar-label">
                  <span class="day-name">
                    {% set days = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'] %}
                    {{ days[day] }}
                  </span>
                  <span class="day-count">{{ range(5, 25) | random }}</span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        
        <div class="activity-summary">
          <h3>Resumen de Actividad</h3>
          <div class="summary-stats">
            <div class="summary-item">
              <div class="summary-icon">üìÖ</div>
              <div class="summary-text">
                <span>D√≠as activos esta semana</span>
                <strong>{{ range(3, 7) | random }}/7</strong>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="summary-icon">‚è±Ô∏è</div>
              <div class="summary-text">
                <span>Tiempo promedio por sesi√≥n</span>
                <strong>{{ range(15, 45) | random }} min</strong>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="summary-icon">üéØ</div>
              <div class="summary-text">
                <span>Mejor d√≠a de la semana</span>
                <strong>Mi√©rcoles</strong>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="summary-icon">üìö</div>
              <div class="summary-text">
                <span>Cards por sesi√≥n (promedio)</span>
                <strong>{{ range(8, 20) | random }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>
  {% else %}
  <!-- Sin datos de progreso -->
  <div class="no-progress">
    <div class="no-progress-icon">üìä</div>
    <h3>Sin Datos de Progreso</h3>
    <p>Este usuario a√∫n no ha comenzado a estudiar o no tiene datos de progreso disponibles.</p>
    <a href="{{ url_for('users.user_detail', user_id=user.id) }}" class="btn-action primary">
      ‚Üê Volver al Usuario
    </a>
  </div>
  {% endif %}
</div>

<style>
/* === VARIABLES ADICIONALES === */
:root {
  --gradient-success: linear-gradient(135deg, #10b981, #34d399);
  --gradient-warning: linear-gradient(135deg, #f59e0b, #fbbf24);
  --gradient-error: linear-gradient(135deg, #ef4444, #f87171);
  --gradient-info: linear-gradient(135deg, #3b82f6, #60a5fa);
}

/* === LAYOUT PRINCIPAL === */
.progress-analytics {
  padding: 1rem;
  max-width: 1400px;
  margin: 0 auto;
}

/* === NAVEGACI√ìN === */
.back-navigation {
  margin-bottom: 1.5rem;
}

.btn-back {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: var(--bg-secondary);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius-sm);
  color: var(--text-secondary);
  text-decoration: none;
  transition: var(--transition);
  font-weight: 500;
}

.btn-back:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  transform: translateX(-2px);
}

.back-icon {
  font-size: 1.2rem;
  font-weight: 700;
}

/* === HEADER === */
.progress-header {
  background: var(--gradient-card);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius-lg);
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: var(--box-shadow);
}

.user-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 2rem;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.user-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--gradient-brand);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 800;
  font-size: 1.5rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.user-details h1 {
  margin: 0 0 0.25rem 0;
  color: var(--text-primary);
  font-size: 1.75rem;
  font-weight: 700;
}

.user-details p {
  margin: 0 0 0.5rem 0;
  color: var(--text-secondary);
  font-size: 1rem;
}

.role-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.role-admin {
  background: rgba(245, 158, 11, 0.2);
  color: #fbbf24;
}

.role-user {
  background: rgba(59, 130, 246, 0.2);
  color: #60a5fa;
}

.progress-overview {
  display: flex;
  gap: 2rem;
}

.overview-stat {
  text-align: center;
  padding: 1rem;
  border-radius: var(--border-radius);
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  min-width: 120px;
  transition: var(--transition);
}

.overview-stat:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.08);
}

.overview-stat.highlight {
  background: rgba(59, 130, 246, 0.15);
  border-color: rgba(59, 130, 246, 0.3);
}

.stat-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.stat-data h3 {
  margin: 0;
  font-size: 2rem;
  font-weight: 800;
  color: var(--text-primary);
}

.stat-data p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.875rem;
  font-weight: 500;
}

/* === CONTENIDO === */
.progress-content {
  display: flex;
  flex-direction: column;
  gap: 3rem;
}

.progress-content section {
  background: var(--bg-card);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius-lg);
  padding: 2rem;
  box-shadow: var(--box-shadow);
}

.progress-content section h2 {
  margin: 0 0 1.5rem 0;
  color: var(--text-primary);
  font-size: 1.5rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* === M√âTRICAS PRINCIPALES === */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.metric-card {
  background: var(--bg-secondary);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.metric-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-brand);
}

.metric-card.primary::before { background: var(--gradient-info); }
.metric-card.success::before { background: var(--gradient-success); }
.metric-card.warning::before { background: var(--gradient-warning); }

.metric-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--box-shadow-lg);
}

.metric-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.metric-icon {
  font-size: 1.5rem;
}

.metric-header h3 {
  margin: 0;
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 600;
}

.metric-value {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--text-accent);
  margin-bottom: 0.5rem;
}

.metric-trend {
  font-size: 0.875rem;
  font-weight: 500;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  display: inline-block;
}

.metric-trend.positive {
  background: rgba(34, 197, 94, 0.2);
  color: #4ade80;
}

.metric-trend.negative {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.metric-subtitle {
  color: var(--text-muted);
  font-size: 0.875rem;
}

/* === RING PROGRESS === */
.metric-progress {
  display: flex;
  justify-content: center;
  margin-top: 1rem;
}

.progress-ring {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: conic-gradient(from 0deg, var(--gradient-success) var(--progress, 0%), rgba(255,255,255,0.1) var(--progress, 0%));
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.progress-ring::before {
  content: '';
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--bg-secondary);
  position: absolute;
}

.progress-ring span {
  color: var(--text-primary);
  font-weight: 700;
  font-size: 0.875rem;
  z-index: 1;
}

/* === AN√ÅLISIS DE PRECISI√ìN === */
.analysis-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.accuracy-chart {
  text-align: center;
}

.chart-header {
  margin-bottom: 2rem;
}

.chart-header h3 {
  margin: 0 0 1rem 0;
  color: var(--text-primary);
}

.chart-legend {
  display: flex;
  justify-content: center;
  gap: 1rem;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.legend-color.correct { background: #4ade80; }
.legend-color.incorrect { background: #f87171; }

.pie-chart {
  display: flex;
  justify-content: center;
  margin-bottom: 2rem;
}

.pie {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    #4ade80 var(--correct, 0%),
    #f87171 var(--correct, 0%)
  );
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.pie-center {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: var(--bg-card);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--bg-secondary);
}

.pie-value {
  font-size: 1.25rem;
  font-weight: 800;
  color: var(--text-primary);
}

.pie-label {
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
}

.accuracy-stats {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-row:last-child {
  border-bottom: none;
}

.stat-label {
  color: var(--text-secondary);
  font-weight: 500;
}

.stat-value {
  color: var(--text-primary);
  font-weight: 700;
}

/* === SISTEMA LEITNER === */
.leitner-explanation {
  background: var(--bg-secondary);
  padding: 1rem;
  border-radius: var(--border-radius-sm);
  margin-bottom: 2rem;
  border-left: 4px solid var(--text-accent);
}

.leitner-explanation p {
  margin: 0;
  color: var(--text-secondary);
  line-height: 1.6;
}

.leitner-flow {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.leitner-box-detailed {
  background: var(--bg-secondary);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius);
  padding: 1rem;
  text-align: center;
  transition: var(--transition);
  position: relative;
}

.leitner-box-detailed:hover {
  transform: translateY(-4px);
  border-color: rgba(255, 255, 255, 0.3);
}

.box-header {
  margin-bottom: 1rem;
}

.box-number {
  font-size: 2rem;
  font-weight: 800;
  color: var(--text-accent);
  margin-bottom: 0.5rem;
}

.box-info h4 {
  margin: 0;
  color: var(--text-primary);
  font-size: 0.875rem;
  font-weight: 600;
}

.box-info p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.75rem;
}

.box-content {
  margin-bottom: 1rem;
}

.box-count {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
}

.box-percentage {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.progress-bar-vertical {
  width: 100%;
  height: 60px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.progress-fill-vertical {
  width: 100%;
  background: var(--gradient-brand);
  position: absolute;
  bottom: 0;
  transition: height 0.5s ease;
}

.box-arrow {
  position: absolute;
  right: -0.5rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-accent);
  font-size: 1.5rem;
  font-weight: 800;
}

/* === INSIGHTS === */
.leitner-insights {
  background: var(--bg-primary);
  padding: 1.5rem;
  border-radius: var(--border-radius);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.leitner-insights h4 {
  margin: 0 0 1rem 0;
  color: var(--text-primary);
  font-size: 1.1rem;
}

.insights-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.insight-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--border-radius-sm);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.insight-icon {
  font-size: 1.5rem;
}

.insight-content h5 {
  margin: 0 0 0.25rem 0;
  color: var(--text-primary);
  font-size: 0.875rem;
  font-weight: 600;
}

.insight-content p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.8rem;
  line-height: 1.3;
}

/* === CATEGOR√çAS === */
.categories-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.category-card {
  background: var(--bg-secondary);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius);
  padding: 1.5rem;
  transition: var(--transition);
}

.category-card:hover {
  transform: translateY(-2px);
  border-color: rgba(255, 255, 255, 0.2);
}

.category-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
}

.category-info h4 {
  margin: 0 0 0.25rem 0;
  color: var(--text-primary);
  font-size: 1.1rem;
}

.category-info p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.875rem;
}

.accuracy-badge {
  padding: 0.375rem 0.75rem;
  border-radius: 20px;
  font-weight: 700;
  font-size: 0.875rem;
}

.accuracy-high {
  background: rgba(34, 197, 94, 0.2);
  color: #4ade80;
}

.accuracy-medium {
  background: rgba(245, 158, 11, 0.2);
  color: #fbbf24;
}

.accuracy-low {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.category-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.detail-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.875rem;
}

.detail-row span:first-child {
  color: var(--text-muted);
}

.detail-row span:last-child {
  color: var(--text-primary);
  font-weight: 600;
}

.text-success { color: #4ade80; }
.text-error { color: #f87171; }

.category-progress-bar {
  width: 100%;
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
}

.category-progress-bar .progress-fill {
  height: 100%;
  background: var(--gradient-success);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.no-categories {
  text-align: center;
  padding: 3rem;
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

/* === ACTIVIDAD === */
.activity-container {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
}

.activity-chart h3, .activity-summary h3 {
  margin: 0 0 1.5rem 0;
  color: var(--text-primary);
  font-size: 1.25rem;
  font-weight: 600;
}

.chart-container {
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--border-radius);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.bar-chart {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  height: 200px;
  gap: 0.5rem;
}

.chart-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}

.bar-fill {
  width: 100%;
  background: var(--gradient-brand);
  border-radius: 4px 4px 0 0;
  min-height: 20px;
  transition: height 0.5s ease;
}

.bar-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.day-name {
  font-size: 0.75rem;
  color: var(--text-muted);
  font-weight: 500;
}

.day-count {
  font-size: 0.875rem;
  color: var(--text-primary);
  font-weight: 600;
}

.summary-stats {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.summary-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--border-radius-sm);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.summary-icon {
  font-size: 1.5rem;
}

.summary-text {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.summary-text span {
  color: var(--text-muted);
  font-size: 0.875rem;
}

.summary-text strong {
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 600;
}

/* === SIN PROGRESO === */
.no-progress {
  text-align: center;
  padding: 4rem 2rem;
  background: var(--bg-card);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--box-shadow);
}

.no-progress-icon {
  font-size: 4rem;
  margin-bottom: 2rem;
  opacity: 0.5;
}

.no-progress h3 {
  margin: 0 0 1rem 0;
  color: var(--text-primary);
  font-size: 2rem;
  font-weight: 700;
}

.no-progress p {
  margin: 0 0 2rem 0;
  color: var(--text-secondary);
  font-size: 1.1rem;
  line-height: 1.6;
}

.btn-action {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem 2rem;
  background: var(--gradient-brand);
  border: none;
  border-radius: var(--border-radius);
  color: white;
  text-decoration: none;
  font-weight: 600;
  transition: var(--transition);
}

.btn-action:hover {
  transform: translateY(-2px);
  box-shadow: var(--box-shadow-lg);
}

/* === RESPONSIVE === */

/* Tablets */
@media (max-width: 1024px) {
  .user-summary {
    flex-direction: column;
    align-items: stretch;
    gap: 1.5rem;
  }
  
  .progress-overview {
    justify-content: center;
    gap: 1rem;
  }
  
  .overview-stat {
    min-width: 100px;
    padding: 0.75rem;
  }
  
  .metrics-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }
  
  .analysis-container {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .leitner-flow {
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .insights-grid {
    grid-template-columns: 1fr;
  }
  
  .activity-container {
    grid-template-columns: 1fr;
  }
  
  .categories-list {
    grid-template-columns: 1fr;
  }
}

/* Mobile */
@media (max-width: 768px) {
  .progress-analytics {
    padding: 0.5rem;
  }
  
  .progress-header {
    padding: 1.5rem;
  }
  
  .user-info {
    flex-direction: column;
    text-align: center;
    gap: 0.75rem;
  }
  
  .user-avatar {
    width: 50px;
    height: 50px;
    font-size: 1.25rem;
  }
  
  .user-details h1 {
    font-size: 1.5rem;
  }
  
  .progress-overview {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .overview-stat {
    padding: 1rem;
  }
  
  .stat-data h3 {
    font-size: 1.5rem;
  }
  
  .progress-content section {
    padding: 1rem;
  }
  
  .metrics-grid {
    grid-template-columns: 1fr;
  }
  
  .metric-card {
    padding: 1rem;
  }
  
  .metric-value {
    font-size: 2rem;
  }
  
  .leitner-flow {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .leitner-box-detailed {
    padding: 0.75rem;
  }
  
  .box-number {
    font-size: 1.5rem;
  }
  
  .box-count {
    font-size: 1.25rem;
  }
  
  .box-arrow {
    display: none;
  }
  
  .category-details {
    grid-template-columns: 1fr;
  }
  
  .bar-chart {
    height: 150px;
  }
  
  .chart-legend {
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }
  
  .pie {
    width: 120px;
    height: 120px;
  }
  
  .pie-center {
    width: 70px;
    height: 70px;
  }
  
  .pie-value {
    font-size: 1rem;
  }
}

/* Small mobile */
@media (max-width: 480px) {
  .back-text {
    display: none;
  }
  
  .progress-overview {
    grid-template-columns: 1fr;
  }
  
  .leitner-flow {
    grid-template-columns: 1fr;
  }
  
  .progress-bar-vertical {
    height: 40px;
  }
  
  .insights-grid {
    gap: 0.5rem;
  }
  
  .insight-card {
    padding: 0.75rem;
  }
  
  .summary-item {
    padding: 0.75rem;
  }
  
  .no-progress {
    padding: 2rem 1rem;
  }
  
  .no-progress h3 {
    font-size: 1.5rem;
  }
}

/* === ANIMACIONES === */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.metric-card,
.leitner-box-detailed,
.category-card,
.insight-card {
  animation: slideInUp 0.3s ease;
}

@keyframes fillProgress {
  from {
    height: 0%;
  }
  to {
    height: var(--height);
  }
}

.progress-fill-vertical {
  animation: fillProgress 1s ease-in-out;
}

/* === ACCESIBILIDAD === */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
  }
}

/* === DARK MODE OPTIMIZATIONS === */
@media (prefers-color-scheme: dark) {
  .chart-container {
    background: var(--bg-tertiary);
  }
  
  .summary-item {
    background: var(--bg-tertiary);
  }
}
</style>
{% endblock %}