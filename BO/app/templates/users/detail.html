<!-- app/templates/users/detail.html - RESPONSIVE & MOBILE FRIENDLY -->
{% extends "backoffice_layout.html" %}

{% block title %}Usuario {{ user.username }} - FirefighterAI BackOffice{% endblock %}
{% block page_title %}Detalles de Usuario{% endblock %}

{% block content %}
<div class="user-detail">
  <!-- Navegaci√≥n de retroceso -->
  <div class="back-navigation">
    <a href="{{ url_for('users.user_list') }}" class="btn-back">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Volver a Usuarios</span>
    </a>
  </div>

  <!-- Perfil del usuario -->
  <div class="user-profile">
    <div class="profile-header">
      <div class="profile-main">
        <div class="user-avatar-large">{{ user.username[0]|upper }}</div>
        <div class="profile-info">
          <h1 class="profile-name">{{ user.username }}</h1>
          <p class="profile-email">{{ user.email }}</p>
          <div class="profile-meta">
            <span class="meta-badge role-{{ user.role }}">{{ user.role|title }}</span>
            <span class="meta-badge status-{{ user.status or 'active' }}">
              {{ (user.status or 'active')|title }}
            </span>
            {% if user.mfa_enabled %}
            <span class="meta-badge mfa-enabled">üõ°Ô∏è MFA Activado</span>
            {% else %}
            <span class="meta-badge mfa-disabled">‚ùå MFA No Activado</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Acciones r√°pidas -->
      <div class="profile-actions">
        <form action="{{ url_for('users.toggle_user_status', user_id=user.id) }}" method="POST"
          style="display: inline;">
          {% if user.status == 'active' %}
          <button type="submit" class="btn-action warning"
            onclick="return confirm('¬øEst√°s seguro de que quieres desactivar este usuario?')">
            ‚è∏Ô∏è Desactivar
          </button>
          {% else %}
          <button type="submit" class="btn-action success"
            onclick="return confirm('¬øEst√°s seguro de que quieres activar este usuario?')">
            ‚ñ∂Ô∏è Activar
          </button>
          {% endif %}
        </form>
        <a href="{{ url_for('users.user_progress', user_id=user.id) }}" class="btn-action primary">
          üìä Ver Progreso
        </a>
        <form method="post" action="{{ url_for('users.delete_user', userid=user.id) }}"
          onsubmit="return confirm('¬øSeguro que quieres eliminar este usuario? Esta acci√≥n lo desactivar√°.');">
          <button type="submit" class="btn btn-danger btn-sm">
            Eliminar usuario
          </button>
        </form>
      </div>
    </div>

    <!-- Informaci√≥n detallada -->
    <div class="profile-details">
      <div class="details-grid">
        <!-- Informaci√≥n b√°sica -->
        <div class="detail-section">
          <h3>üìã Informaci√≥n B√°sica</h3>
          <div class="detail-content">
            <div class="detail-item">
              <span class="detail-label">ID de Usuario</span>
              <span class="detail-value mono">{{ user.id }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Nombre de Usuario</span>
              <span class="detail-value">{{ user.username }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Correo Electr√≥nico</span>
              <span class="detail-value">{{ user.email }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Rol</span>
              <span class="detail-value">
                <span class="role-badge role-{{ user.role }}">{{ user.role|title }}</span>
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Estado</span>
              <span class="detail-value">
                <span class="status-badge status-{{ user.status or 'active' }}">
                  {{ (user.status or 'active')|title }}
                </span>
              </span>
            </div>
          </div>
        </div>

        <!-- Seguridad -->
        <div class="detail-section">
          <h3>üîí Seguridad</h3>
          <div class="detail-content">
            <div class="detail-item">
              <span class="detail-label">Autenticaci√≥n MFA</span>
              <span class="detail-value">
                {% if user.mfa_enabled %}
                <span class="mfa-badge enabled">üõ°Ô∏è Activado</span>
                {% else %}
                <span class="mfa-badge disabled">‚ùå No activado</span>
                {% endif %}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">√öltimo Acceso</span>
              <span class="detail-value">{{ user.last_login or 'Nunca' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Fecha de Registro</span>
              <span class="detail-value">
                {% if user.created_at_str %}
                {{ user.created_at_str[:10]|replace('-', '/') }} {{ user.created_at_str[11:16] }}
                {% else %}
                No disponible
                {% endif %}
              </span>
            </div>
          </div>
        </div>

        <!-- Actividad -->
        <div class="detail-section">
          <h3>üìà Actividad</h3>
          <div class="detail-content">
            <div class="detail-item">
              <span class="detail-label">Total Sesiones</span>
              <span class="detail-value">{{ user.total_sessions or 0 }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Tiempo Total</span>
              <span class="detail-value">{{ user.total_time or '0 min' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">√öltima Actividad</span>
              <span class="detail-value">{{ user.last_activity or 'No disponible' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de progreso (si existe) -->
    {% if progress and progress.ok and (progress.stats or progress.progress) %}
    <div class="progress-section">
      <div class="section-header">
        <h2>üìä Progreso de Estudio</h2>
        <a href="{{ url_for('users.user_progress', user_id=user.id) }}" class="btn-link">
          Ver Detallado ‚Üí
        </a>
      </div>

      <!-- Estad√≠sticas r√°pidas -->
      <div class="stats-overview">
        <div class="stat-item">
          <div class="stat-icon">üéØ</div>
          <div class="stat-content">
            <h4>{{ progress.general_stats.total_cards }}</h4>
            <p>Total Cards</p>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon">üìù</div>
          <div class="stat-content">
            <h4>{{ progress.general_stats.total_reviews }}</h4>
            <p>Reviews</p>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-content">
            <h4>{{ progress.general_stats.accuracy_rate }}%</h4>
            <p>Precisi√≥n</p>
          </div>
        </div>

        <div class="stat-item">
          <div class="stat-icon">üî•</div>
          <div class="stat-content">
            <h4>{{ progress.general_stats.study_streak }}</h4>
            <p>Racha</p>
          </div>
        </div>
      </div>

      <!-- Distribuci√≥n de cajas Leitner -->
      <div class="leitner-distribution">
        <h4>üì¶ Distribuci√≥n Leitner</h4>
        <div class="boxes-grid">
          {% for i in range(1, 7) %}
          <div class="leitner-box box-{{ i }}">
            <div class="box-header">
              <span class="box-number">{{ i }}</span>
              <span class="box-label">Box {{ i }}</span>
            </div>
            <div class="box-count">
              {{ progress.leitner_distribution[i-1] if progress.leitner_distribution and i-1 <
                progress.leitner_distribution|length else 0 }} </div>
                <div class="box-progress">
                  <div class="progress-bar">
                    {% set total = progress.general_stats.total_cards %}
                    {% set count = progress.leitner_distribution[i-1] if progress.leitner_distribution and i-1 <
                      progress.leitner_distribution|length else 0 %} {% set percentage=(count / total * 100) if total> 0
                      else 0 %}
                      <div class="progress-fill" style="width: {{ percentage }}%"></div>
                  </div>
                </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Acciones adicionales -->
      <div class="additional-actions">
        <div class="actions-grid">
          <button class="action-card" onclick="resetUserProgress('{{ user.id }}')">
            <div class="action-icon">üîÑ</div>
            <div class="action-text">
              <h4>Reiniciar Progreso</h4>
              <p>Reiniciar el progreso de estudio del usuario</p>
            </div>
          </button>

          <button class="action-card" onclick="exportUserData('{{ user.id }}')">
            <div class="action-icon">üì§</div>
            <div class="action-text">
              <h4>Exportar Datos</h4>
              <p>Descargar datos del usuario en CSV</p>
            </div>
          </button>

          <button class="action-card" onclick="sendNotification('{{ user.id }}')">
            <div class="action-icon">üìß</div>
            <div class="action-text">
              <h4>Enviar Notificaci√≥n</h4>
              <p>Enviar mensaje al usuario</p>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* === LAYOUT PRINCIPAL === */
    .user-detail {
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* === NAVEGACI√ìN === */
    .back-navigation {
      margin-bottom: 1.5rem;
    }

    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-sm);
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
    }

    .btn-back:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateX(-2px);
    }

    .back-icon {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .back-text {
      font-size: 0.95rem;
    }

    /* === PERFIL DEL USUARIO === */
    .user-profile {
      background: var(--bg-card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }

    .profile-header {
      background: var(--gradient-card);
      padding: 2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 2rem;
    }

    .profile-main {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      flex: 1;
    }

    .user-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--gradient-brand);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 2rem;
      flex-shrink: 0;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .profile-info {
      flex: 1;
      min-width: 0;
    }

    .profile-name {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 0.5rem 0;
      line-height: 1.2;
    }

    .profile-email {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin: 0 0 1rem 0;
      word-break: break-word;
    }

    .profile-meta {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .meta-badge {
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid transparent;
    }

    .profile-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      flex-shrink: 0;
    }

    /* === BADGES === */
    .role-admin {
      background: rgba(245, 158, 11, 0.2);
      color: #fbbf24;
      border-color: rgba(245, 158, 11, 0.3);
    }

    .role-user {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      border-color: rgba(59, 130, 246, 0.3);
    }

    .role-viewer {
      background: rgba(139, 92, 246, 0.2);
      color: #a78bfa;
      border-color: rgba(139, 92, 246, 0.3);
    }

    .status-active {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border-color: rgba(34, 197, 94, 0.3);
    }

    .status-inactive {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border-color: rgba(239, 68, 68, 0.3);
    }

    .mfa-badge.enabled {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border-color: rgba(34, 197, 94, 0.3);
    }

    .mfa-badge.disabled {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border-color: rgba(239, 68, 68, 0.3);
    }

    /* === BOTONES DE ACCI√ìN === */
    .btn-action {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    .btn-action.primary {
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .btn-action.primary:hover {
      background: rgba(59, 130, 246, 0.3);
      transform: translateY(-1px);
    }

    .btn-action.warning {
      background: rgba(245, 158, 11, 0.2);
      color: #fbbf24;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .btn-action.warning:hover {
      background: rgba(245, 158, 11, 0.3);
      transform: translateY(-1px);
    }

    .btn-action.success {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .btn-action.success:hover {
      background: rgba(34, 197, 94, 0.3);
      transform: translateY(-1px);
    }

    /* === DETALLES === */
    .profile-details {
      padding: 2rem;
    }

    .details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }

    .detail-section {
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .detail-section h3 {
      margin: 0 0 1.5rem 0;
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .detail-content {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .detail-item:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 500;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .detail-value {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.9rem;
      text-align: right;
    }

    .detail-value.mono {
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      word-break: break-all;
    }

    /* === PROGRESO === */
    .progress-section {
      padding: 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--bg-secondary);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .section-header h2 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-link {
      color: var(--text-accent);
      text-decoration: none;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-sm);
      border: 1px solid rgba(59, 130, 246, 0.3);
      transition: var(--transition);
    }

    .btn-link:hover {
      background: rgba(59, 130, 246, 0.1);
      transform: translateX(2px);
    }

    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem 1rem;
      background: var(--bg-card);
      border-radius: var(--border-radius);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: var(--transition);
    }

    .stat-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }

    .stat-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .stat-content h4 {
      margin: 0 0 0.25rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-accent);
    }

    .stat-content p {
      margin: 0;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    /* === DISTRIBUCI√ìN LEITNER === */
    .leitner-distribution {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .leitner-distribution h4 {
      margin: 0 0 1.5rem 0;
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .boxes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 1rem;
    }

    .leitner-box {
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: var(--border-radius-sm);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: var(--transition);
    }

    .leitner-box:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .box-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1rem;
    }

    .box-number {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-accent);
    }

    .box-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .box-count {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-brand);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    /* === ACCIONES ADICIONALES === */
    .additional-actions {
      padding: 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--bg-primary);
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .action-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem;
      background: var(--bg-card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      text-align: left;
    }

    .action-card:hover {
      background: var(--bg-secondary);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }

    .action-icon {
      font-size: 2.5rem;
      flex-shrink: 0;
    }

    .action-text h4 {
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 600;
    }

    .action-text p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.875rem;
      line-height: 1.4;
    }

    /* === RESPONSIVE === */

    /* Tablets */
    @media (max-width: 1024px) {
      .profile-header {
        flex-direction: column;
        align-items: stretch;
        gap: 1.5rem;
      }

      .profile-main {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }

      .profile-actions {
        flex-direction: row;
        justify-content: center;
        flex-wrap: wrap;
      }

      .details-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .stats-overview {
        grid-template-columns: repeat(2, 1fr);
      }

      .boxes-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    /* Mobile */
    @media (max-width: 768px) {
      .user-detail {
        padding: 0.5rem;
      }

      .profile-header {
        padding: 1.5rem;
      }

      .user-avatar-large {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
      }

      .profile-name {
        font-size: 1.5rem;
      }

      .profile-email {
        font-size: 1rem;
      }

      .profile-meta {
        justify-content: center;
      }

      .meta-badge {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
      }

      .btn-action {
        padding: 0.625rem 1rem;
        font-size: 0.8rem;
      }

      .profile-details {
        padding: 1rem;
      }

      .detail-section {
        padding: 1rem;
      }

      .detail-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .detail-value {
        text-align: left;
      }

      .progress-section {
        padding: 1rem;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .stats-overview {
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
      }

      .stat-item {
        padding: 1rem 0.75rem;
      }

      .stat-icon {
        font-size: 1.5rem;
        margin-bottom: 0.75rem;
      }

      .stat-content h4 {
        font-size: 1.25rem;
      }

      .boxes-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .additional-actions {
        padding: 1rem;
      }

      .actions-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .action-card {
        padding: 1rem;
      }

      .action-icon {
        font-size: 2rem;
      }
    }

    /* Small mobile */
    @media (max-width: 480px) {
      .back-text {
        display: none;
      }

      .profile-actions {
        flex-direction: column;
      }

      .stats-overview {
        grid-template-columns: 1fr;
      }

      .boxes-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
      }

      .leitner-box {
        padding: 0.75rem 0.5rem;
      }

      .box-number {
        font-size: 1.25rem;
      }

      .box-count {
        font-size: 1rem;
      }
    }

    /* === ANIMATIONS === */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .detail-section,
    .stat-item,
    .leitner-box,
    .action-card {
      animation: slideInUp 0.3s ease;
    }

    /* === ACCESIBILIDAD === */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }

    /* === FUNCIONES JAVASCRIPT === */
  </style>

  <script>
    // Funciones para acciones adicionales
    function resetUserProgress(userId) {
      if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso de este usuario? Esta acci√≥n no se puede deshacer.')) {
        // Implementar llamada a API para reiniciar progreso
        console.log('Reiniciando progreso para usuario:', userId);
      }
    }

    function exportUserData(userId) {
      // Implementar exportaci√≥n de datos
      console.log('Exportando datos para usuario:', userId);
    }

    function sendNotification(userId) {
      const message = prompt('Escribe el mensaje que quieres enviar al usuario:');
      if (message) {
        // Implementar env√≠o de notificaci√≥n
        console.log('Enviando notificaci√≥n a usuario:', userId, 'Mensaje:', message);
      }
    }
  </script>
  {% endblock %}